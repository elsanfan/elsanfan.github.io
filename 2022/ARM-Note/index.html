

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="闲卧庭前远看帆">
  <meta name="keywords" content="">
  <meta name="description" content="产业链 CUP核 SOC芯片 — System On Chip （CPU核 + 外围控制器） 产品  ARM核工作模式（USA UFI SM）八大工作模式用户模式（USR：User）— 唯一非特权 用户程序的工作模式，运行在操作系统的用户态，没有操作其他硬件的权限 只有它不是特权模式（privilege mode） 只能执行处理自己的数据，不能切换到其他模式下，访问硬件资源或切换到其他模式只能通过">
<meta property="og:type" content="article">
<meta property="og:title" content="ARM基础笔记">
<meta property="og:url" content="https://code.阿帆的小窝.top/2022/ARM-Note/index.html">
<meta property="og:site_name" content="闲卧庭前远看帆的博客">
<meta property="og:description" content="产业链 CUP核 SOC芯片 — System On Chip （CPU核 + 外围控制器） 产品  ARM核工作模式（USA UFI SM）八大工作模式用户模式（USR：User）— 唯一非特权 用户程序的工作模式，运行在操作系统的用户态，没有操作其他硬件的权限 只有它不是特权模式（privilege mode） 只能执行处理自己的数据，不能切换到其他模式下，访问硬件资源或切换到其他模式只能通过">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/ARM_Registers.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/CPSR.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/stack.jpg">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/Instruction_pipeline.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/PWM Timer.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/pwm.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/RS232、RS485.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/UART.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/Expection Handling.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/interrupt.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/interrupt_handling.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/MPCore.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/GIC.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/IIC_Bus.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/IIC_ReadSequence.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/IIC_WriteSequence.png">
<meta property="article:published_time" content="2022-05-26T12:33:34.000Z">
<meta property="article:modified_time" content="2022-06-06T11:37:37.375Z">
<meta property="article:author" content="闲卧庭前远看帆">
<meta property="article:tag" content="ARM">
<meta property="article:tag" content="底层开发">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/ARM_Registers.png">
  
  <title>ARM基础笔记 - 闲卧庭前远看帆的博客</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/atom-one-dark.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"code.xn--yetp9bp76b6xdqv7b.top","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":80,"cursorChar":"|","loop":true},"anchorjs":{"enable":false,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"#"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":3},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 100vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>闲卧庭前远看帆の博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                主页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                文章
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/">
                    
                    分类
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/archives/">
                    
                    归档
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/tags/">
                    
                    标签
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo@main/img/morncolour05.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="ARM基础笔记">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      闲卧庭前远看帆
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-05-26 20:33" pubdate>
        2022年5月26日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      9.2k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      29 分钟
    </span>
  

  
  
</div>

            
          </div>

          
            <div class="scroll-down-bar">
              <i class="iconfont icon-arrowdown"></i>
            </div>
          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">ARM基础笔记</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2022年6月6日 晚上
                
              </p>
            
            <div class="markdown-body">
              <h1 id="产业链"><a href="#产业链" class="headerlink" title="产业链"></a>产业链</h1><ul>
<li>CUP核</li>
<li><strong>SOC芯片 — System On Chip （CPU核 + 外围控制器）</strong></li>
<li>产品</li>
</ul>
<h1 id="ARM核工作模式（USA-UFI-SM）"><a href="#ARM核工作模式（USA-UFI-SM）" class="headerlink" title="ARM核工作模式（USA UFI SM）"></a>ARM核工作模式（USA UFI SM）</h1><h2 id="八大工作模式"><a href="#八大工作模式" class="headerlink" title="八大工作模式"></a>八大工作模式</h2><h3 id="用户模式（USR：User）—-唯一非特权"><a href="#用户模式（USR：User）—-唯一非特权" class="headerlink" title="用户模式（USR：User）— 唯一非特权"></a>用户模式（USR：User）— 唯一非特权</h3><ul>
<li>用户程序的工作模式，运行在<strong>操作系统的用户态</strong>，<strong>没有操作其他硬件的权限</strong></li>
<li><strong>只有它不是特权模式（privilege mode）</strong></li>
<li>只能执行处理自己的数据，不能切换到其他模式下，<strong>访问硬件资源</strong>或<strong>切换到其他模式</strong>只能通过<strong>软中断或者异常</strong></li>
</ul>
<h3 id="系统模式（SYS：System）—-特权"><a href="#系统模式（SYS：System）—-特权" class="headerlink" title="系统模式（SYS：System）— 特权"></a>系统模式（SYS：System）— 特权</h3><ul>
<li><strong>不受用户模式的限制</strong>，用户模式核系统模式共用一套寄存器</li>
<li>操作系统的一些特权任务，可以用该模式访<strong>问一些受控资源</strong></li>
</ul>
<h3 id="终止模式（ABT：Abort）—-异常"><a href="#终止模式（ABT：Abort）—-异常" class="headerlink" title="终止模式（ABT：Abort）— 异常"></a>终止模式（ABT：Abort）— 异常</h3><ul>
<li>用域支持<strong>虚拟内存或存储器保护</strong></li>
<li><strong>用户程序访问非法地址、没有权限的地址，进入该模式</strong>（如：段错误）</li>
</ul>
<h3 id="未定义模式（UDF：Undefined）—-异常"><a href="#未定义模式（UDF：Undefined）—-异常" class="headerlink" title="未定义模式（UDF：Undefined）— 异常"></a>未定义模式（UDF：Undefined）— 异常</h3><ul>
<li>用于支持硬件协处理器的软件仿真</li>
<li><strong>CPU在指令的译码阶段不能识别该指令操作</strong>时，进入该模式</li>
</ul>
<h3 id="快速中断模式（FIQ：Fast-Interrupt-Request）—-异常"><a href="#快速中断模式（FIQ：Fast-Interrupt-Request）—-异常" class="headerlink" title="快速中断模式（FIQ：Fast Interrupt Request）— 异常"></a>快速中断模式（FIQ：Fast Interrupt Request）— 异常</h3><ul>
<li>用于处理对<strong>时间要求紧急的中断请求</strong>， 主要用于<strong>高速数据传输及通道处理</strong></li>
</ul>
<h3 id="一般中断模式（IRQ：Interrupt-Request）—-异常"><a href="#一般中断模式（IRQ：Interrupt-Request）—-异常" class="headerlink" title="一般中断模式（IRQ：Interrupt Request）— 异常"></a>一般中断模式（IRQ：Interrupt Request）— 异常</h3><ul>
<li>也叫普通中断，用于<strong>处理一般中断请求，通常在硬件产生中断信号会自动进入该模式</strong></li>
<li>可以自由访问系统硬件资源</li>
</ul>
<h3 id="管理模式（SVC：Supervisor）—-异常"><a href="#管理模式（SVC：Supervisor）—-异常" class="headerlink" title="管理模式（SVC：Supervisor）— 异常"></a>管理模式（SVC：Supervisor）— 异常</h3><ul>
<li>CPU上电后的默认模式，主要用作<strong>系统初始化（复位异常），软中断处理</strong></li>
<li><strong>用户模式下，用户程序请求使用硬件资源时，通过软中断进入该模式</strong></li>
</ul>
<h3 id="安全监控模式（MON：Monitor）"><a href="#安全监控模式（MON：Monitor）" class="headerlink" title="安全监控模式（MON：Monitor）"></a>安全监控模式（MON：Monitor）</h3><ul>
<li><strong>TrustZone — 讲SOC的硬件和软件资源划分程安全和非安全两个世界</strong></li>
<li>安全世界：所有需要保密的操作 — 指纹识别、密码处理、数据加解密等</li>
<li>非安全世界：用户操作系统、各种应用程序</li>
<li>两个世界通过Monitor Mode的模式进行转换</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>唯一非特权：User</li>
<li>五大异常模式：ABT、UDF、FIQ、IRQ、SVC</li>
<li>安全模式：MON</li>
<li>中断和异常的区别：异常包含了中断，中断只是异常的一种</li>
</ul>
<h1 id="寄存器资源"><a href="#寄存器资源" class="headerlink" title="寄存器资源"></a>寄存器资源</h1><h2 id="寄存器分类-（Registers）"><a href="#寄存器分类-（Registers）" class="headerlink" title="寄存器分类 （Registers）"></a>寄存器分类 （Registers）</h2><ul>
<li><p><strong>ARM态</strong>通用寄存器和程序计数器 — R0~R15</p>
</li>
<li><p><strong>ARM态</strong>程序状态寄存器 — CPSR、SPSR</p>
</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/ARM_Registers.png" srcset="/img/loading.gif" lazyload style="zoom: 67%;" />

<h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><ul>
<li><p><strong>R0~R10</strong> — 存放用户数据</p>
</li>
<li><p><strong>R11</strong> （fp：frame-pointer）— 栈帧指针 记录一个<strong>栈空间的起始地址</strong></p>
</li>
<li><p><strong>R12</strong>（ip：The Intra-Procedure-call scratch register）— <strong>临时存储sp</strong>（R13）</p>
</li>
<li><p><strong>R13</strong>（sp：stack pointer）— <strong>栈指针寄存器， 栈空间的结束地址</strong></p>
</li>
<li><p><strong>R14</strong>（lr：link register）— <strong>发送跳转，保存PC寄存器的值</strong></p>
</li>
<li><p><strong>R15</strong>（pc：program counter）— <strong>程序计数器，存放CPU需要执行的下一条指令的内存地址</strong></p>
</li>
<li><p><strong>CPSR</strong>（Current Program Status Register）— 记录当前CPU状态</p>
<blockquote>
<img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/CPSR.png" srcset="/img/loading.gif" lazyload style="zoom: 67%;" /></blockquote>
</li>
<li><p><strong>SPSR</strong>（Saved Program Status Register）— 异常产生时候，保存CPSR的值</p>
</li>
</ul>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p>ARM寄存器 — 40个，一种模式最多 —18个寄存器</p>
</li>
<li><p>所有模式共享 — R0~R7、R15、CPSR</p>
</li>
<li><p>除FIQ其他模式共享 — R8~R12</p>
</li>
<li><p>5大异常模式私有 — R13~R14、SPSR</p>
</li>
<li><p>MON私有 — R13~R14、SPSR</p>
</li>
<li><p><strong>FIQ — 中断更快的三大原因</strong></p>
<blockquote>
<ul>
<li>更多私有寄存器，私有寄存器使用不需要做保护，FIQ恢复现场更快</li>
<li>FIQ在异常向量表的最高位，省去了跳转的过程，速度更快</li>
<li>FIQ的处理优先级比IRQ更高，甚至可以打断正在执行的IRQ</li>
</ul>
</blockquote>
</li>
<li><p><strong>User 和System模式没有SPSR</strong>，因为它们产生异常时，跳转到其他模式执行，是他们的状态被其他模式保存</p>
</li>
</ul>
<h1 id="常用ARM核指令"><a href="#常用ARM核指令" class="headerlink" title="常用ARM核指令"></a>常用ARM核指令</h1><h2 id="指令格式"><a href="#指令格式" class="headerlink" title="指令格式"></a>指令格式</h2><p><code>&lt;opcode&gt; &#123;&lt;cond&gt;&#125; &#123;S&#125;     &lt;Rd&gt; ,&lt;Rn&gt;&#123;, &lt;operand2&gt;&#125;</code></p>
<ul>
<li><p>opcode : 操作码 </p>
</li>
<li><p>cond ：条件</p>
<blockquote>
<ul>
<li>NE、EQ、GT、LT、GE、LE</li>
</ul>
</blockquote>
</li>
<li><p>S：指令执行结果，影响CPSR的N，Z，C，V</p>
</li>
<li><p>Rd：目标寄存器，存放指令执行结果R0~R15</p>
</li>
<li><p>Rn：操作数1，必须是寄存器</p>
</li>
<li><p>operand2：操作数2</p>
<blockquote>
<ul>
<li><p>立即数：<code>#100</code> ,一个常数，一个8位常数通过循环右移偶数位，得到它，则该数字为合法立即数</p>
<blockquote>
<p>把一个数转换为32bit，16进制</p>
<ul>
<li>除零外，仅有一位数，为合法立即数</li>
<li>除零外，仅有两位数，且相邻（包括首尾），为合法立即数</li>
<li>除零外，仅有三位数字，且相邻（包括中间有0，首尾相邻），这三位数，最高位只能取1、2、3；最低位只能取4、8、C，这样的组合为合法立即数</li>
</ul>
</blockquote>
</li>
<li><p>寄存器</p>
</li>
<li><p>寄存器移位：只能寄存器移位</p>
<blockquote>
<ul>
<li>LSL:逻辑左移</li>
<li>LSR:逻辑右移</li>
<li>ASR:算数右移</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
<p><strong>注意：操作数1，只能是寄存器</strong></p>
<h2 id="数据传送指令"><a href="#数据传送指令" class="headerlink" title="数据传送指令"></a>数据传送指令</h2><ul>
<li><p>MOV：<code>MOV 目标寄存器，操作数2</code></p>
<blockquote>
<p>将操作数2的值 赋值给目标寄存器</p>
</blockquote>
</li>
<li><p>MVN：<code>MVN 目标寄存器 , 操作数2</code></p>
<blockquote>
<p>将操作数2 取反的值，给目标寄存器</p>
</blockquote>
</li>
<li><p>LDR：<code>LDR 目标寄存器， =数据</code></p>
<blockquote>
<p>任意数据传送到目标寄存器</p>
<ul>
<li>如果后面是一个合法立即数，翻译成MOV指令</li>
<li>如果是非法立即数，翻译成 LDR Rn, [PC]</li>
</ul>
</blockquote>
</li>
</ul>
<p><strong>注意：</strong> <strong>MOV指令 用立即数</strong>，<strong>效率更高</strong>，CPU获取指令时，指令和数据都翻译成机器码，指令和数据同时获取，因此效率更高</p>
<p>但，不是所有数据都能被和指令同时获取，因此，有了合法立即数的概念，一条指令中八位是数据位</p>
<h2 id="数据计算指令"><a href="#数据计算指令" class="headerlink" title="数据计算指令"></a>数据计算指令</h2><ul>
<li><p>ADD：<code>ADD 目标寄存器，操作数1，操作数2</code></p>
</li>
<li><p>SUB：<code>SUB 目标寄存器，操作数1，操作数2</code></p>
</li>
<li><p>MUL：<code>目标寄存器, 操作数1，操作数2</code></p>
<blockquote>
<p><strong>注意：MUL的目标寄存器，和操作数1，编号不能相同</strong></p>
<p><strong>MUL 两个操作数都要是简单寄存器</strong></p>
</blockquote>
</li>
</ul>
<h2 id="位运算指令"><a href="#位运算指令" class="headerlink" title="位运算指令"></a>位运算指令</h2><ul>
<li><p>AND：<code>AND 目标寄存器，操作数1，操作数2</code></p>
<blockquote>
<p>将操作数1，<strong>按位与</strong> ，操作数2，结果存放在目标寄存器</p>
</blockquote>
</li>
<li><p>ORR：<code>ORR 目标寄存器，操作数1，操作数2</code></p>
<blockquote>
<p>操作数1，按位或，操作数2，结果存放在目标寄存器</p>
</blockquote>
</li>
<li><p>EOR：<code>EOR 目标寄存器， 操作数1，操作数2</code></p>
<blockquote>
<p>将操作数1，按位异或，操作数2，结果放在目标寄存器</p>
</blockquote>
</li>
<li><p>BIC：<code>BIC 目标寄存器，操作数1，操作数2</code></p>
<blockquote>
<p>目标寄存器 = 操作数1 &amp; ~操作数2</p>
</blockquote>
<p>如果想把data的某些位，变成自己想要的值：</p>
<ul>
<li><p><strong>先将对应的位清0，然后再或上对应的值（对应的值左移得到）</strong></p>
</li>
<li><blockquote>
<p>清0：先对应位数，几位就几个1，从第几位开始，就左移几位，再取反，再和源数字按位与&amp;</p>
<p>置1：目标数字，左移，从第几位开始就左移几位，再和源数字按位或 |</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="比较指令"><a href="#比较指令" class="headerlink" title="比较指令"></a>比较指令</h2><ul>
<li><p>CMP：<code>CMP 寄存器，操作数2</code></p>
<blockquote>
<p>CMP指令会自动影响CPSR的N、Z、C、V</p>
<p>CMP执行时不关心之前执行了什么指令，只关心CPSR的NZCV表示的条件是否满足条件，满足执行，不满足不执行</p>
</blockquote>
</li>
</ul>
<h2 id="跳转指令"><a href="#跳转指令" class="headerlink" title="跳转指令"></a>跳转指令</h2><ul>
<li><p>B/BL ：只能跳转+/- 32M范围，跳转到一个指定标签</p>
<blockquote>
<p><code>B 标签</code></p>
<p><code>BL 标签</code> ：BL跳转之前，将跳转前的PC（R15）值保存在LR（R14）</p>
</blockquote>
</li>
<li><p>给PC赋值：没有范围限制</p>
<p><code>LDR PC , =标签名</code></p>
</li>
</ul>
<h2 id="内存访问指令"><a href="#内存访问指令" class="headerlink" title="内存访问指令"></a>内存访问指令</h2><h3 id="单个数据访问"><a href="#单个数据访问" class="headerlink" title="单个数据访问"></a>单个数据访问</h3><ul>
<li><p>LDR（Load Register）：将内存的值加载到寄存器（读内存）</p>
</li>
<li><p>STR（Store Register）：将寄存器的值写入内存（写内存）</p>
</li>
<li><p><strong>寄存器间接寻址：</strong></p>
<blockquote>
<ul>
<li>LDR r0, <strong>[r1]</strong> —-&gt; (r0 = *r1)</li>
<li>STR r0，**[r1]** —-&gt;  (*r1 = r0)</li>
</ul>
</blockquote>
</li>
<li><p><strong>基址变址寻址</strong>：将基地址寄存器 + 指令中给出的偏移量 = 数据存放的地址</p>
<blockquote>
<ul>
<li><p>前索引：</p>
<blockquote>
<ul>
<li>STR r0, [r1, #4] —-&gt; *(r1 + 4) = r0</li>
<li>LDR r0, [r1, #4] —-&gt; r0 = *(r1 + 4)</li>
</ul>
</blockquote>
</li>
<li><p>后索引:</p>
<blockquote>
<ul>
<li>STR r0, [r1], #4 —-&gt; *r1 = r0 ; <strong>r1 = r1 + 4</strong></li>
<li>LDR r0, [r1], #4 —-&gt; r0 = *r1; <strong>r1 = r1  + 4</strong></li>
</ul>
</blockquote>
</li>
<li><p>自动索引:</p>
<blockquote>
<ul>
<li><p>STR r0, [r1, #4] ! —-&gt; *(r1 + 4) = r0; <strong>r1 = r1 + 4</strong></p>
</li>
<li><p>LDR r0, [r1, #4] ! —-&gt; r0 = *(r1 + 4); <strong>r1 = r1 + 4</strong></p>
</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="多个数据访问"><a href="#多个数据访问" class="headerlink" title="多个数据访问"></a>多个数据访问</h3><ul>
<li><p>LDM ：读内存数据，加载到多个寄存器</p>
<blockquote>
<p><strong>LDM</strong> {条件}{s} &lt;MODE&gt; 基质寄存器 {!} , {Reglist}^</p>
</blockquote>
</li>
<li><p>STM：将多个寄存器的值，存储到一块内存</p>
<blockquote>
<p><strong>STM</strong> {条件}{s} &lt;MODE&gt; 基质寄存器 {!} , {Reglist}^</p>
</blockquote>
</li>
<li><p>MODE：</p>
<blockquote>
<ul>
<li>IA （increase after）— 后增加地址</li>
<li>IB （increase before）— 先增加地址</li>
<li>DA（decrease after）— 后减少地址</li>
<li>DB（decrease before）— 先减少地址</li>
</ul>
</blockquote>
</li>
<li><p>基址寄存器 ：存放内存的起始地址</p>
</li>
<li><p>！：最后更新基址寄存器的值</p>
</li>
<li><p>Reglist ：寄存器列表</p>
<blockquote>
<ul>
<li>多个寄存器从小到大，中间用“，”隔开{r0, r1, r2} 或 {r0, r7- r10}</li>
<li>寄存器编号大的 —- 内存高地址； 寄存器编号小的 —- 内存低地址</li>
</ul>
</blockquote>
</li>
<li><p>^ : 它存在：</p>
<blockquote>
<ul>
<li>Reglist 没有PC寄存器的时候，操作的寄存器是用户模式下的寄存器</li>
<li>在LDM指令中，有PC的时候，数据传输时，会将SPSR的值拷贝到CPSR，用于异常返回</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="栈操作指令"><a href="#栈操作指令" class="headerlink" title="栈操作指令"></a>栈操作指令</h3><ul>
<li><p>进（压）栈： <strong>stmfd sp!</strong> , {寄存器列表}</p>
</li>
<li><p>出栈：<strong>ldmfd sp!</strong> , {寄存器列表}</p>
</li>
<li><p>进行栈操作前<strong>，必须先设置sp的值</strong></p>
</li>
<li><p>进栈和出栈方式一样，<strong>ATPCS标准规定满减栈</strong></p>
</li>
<li><p>几种栈操作方式：</p>
<blockquote>
<img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/stack.jpg" srcset="/img/loading.gif" lazyload></blockquote>
</li>
</ul>
<h2 id="CPSR-SPSR操作指令"><a href="#CPSR-SPSR操作指令" class="headerlink" title="CPSR/SPSR操作指令"></a>CPSR/SPSR操作指令</h2><ul>
<li><p>读操作：</p>
<blockquote>
<ul>
<li><p>MRS Rn, CPSR/SPSR</p>
<p>将状态寄存器的值，读到通用寄存器</p>
</li>
</ul>
</blockquote>
</li>
<li><p>写操作：</p>
<blockquote>
<ul>
<li><p>MSR CPSR/SPSR， Rn</p>
<p>将通用寄存器的值，写到状态寄存器</p>
</li>
</ul>
</blockquote>
</li>
</ul>
<h1 id="指令流水线"><a href="#指令流水线" class="headerlink" title="指令流水线"></a>指令流水线</h1><p>（instruction pipeline）—- 以三级流水线为例</p>
<ul>
<li>预取 （fetch）— <strong>PC寄存器工作在预取阶段</strong></li>
<li>译码 （decode）</li>
<li>执行 （execute）</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/Instruction_pipeline.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="伪指令"><a href="#伪指令" class="headerlink" title="伪指令"></a>伪指令</h1><p>**链接地址:**编译器在编译程序的时候，指定的地址，指定这个地址的目的是期望程序在指定的链接地址执行</p>
<p>**运行地址:**程序实际在内存中的运行地址</p>
<p>伪指令：为了方便程序员使用，<strong>编译器设计的指令</strong>，该指令ARM核无法识别，需要编译器进行翻译</p>
<h2 id="常用的伪指令"><a href="#常用的伪指令" class="headerlink" title="常用的伪指令"></a>常用的伪指令</h2><ul>
<li><p>LDR r0, =0x999  —-&gt; LDR r0, [PC]</p>
</li>
<li><p><strong>LDR r0,</strong> **=Label **  —-&gt; LDR r0, [PC ,# 固定偏移量] </p>
<blockquote>
<p>读取Label标签表示的地址，存放到r0中，<strong>这个标签最终表示的地址受链接地址的影响</strong></p>
<blockquote>
<p>编译器：根据指定的代码开始地址，算出Label标签对应地址，存放在内存中，，通过内存访问指令，根据<strong>PC + 固定偏移量</strong>，读取内存值。换言之，<strong>代码编译结束时候，PC + 固定偏移量表示的内存地址中存放的数据就已经确定死了</strong></p>
</blockquote>
</blockquote>
</li>
<li><p>LDR r0,  Label  —-&gt; LDR r0, [PC, # 固定偏移量]</p>
<blockquote>
<p>读取Label标签表示的地址的内容</p>
</blockquote>
</li>
<li><p><strong>ADR r0, Label</strong> —&gt; <strong>根据当前PC的值 +/-偏移量，动态获取当前Label表示的内存地址</strong></p>
</li>
<li><p>问题：如何判别代码在实际内存中运行的地址？</p>
<blockquote>
<ul>
<li>ADR r0，_start 可以知道，因为它根据PC值，动态获取</li>
<li>LDR r0, =_start 无法知道，这条指令不论在哪运行，r0的值都是固定的（取决于指定的链接地址）</li>
</ul>
</blockquote>
</li>
</ul>
<h1 id="汇编与C混合编程"><a href="#汇编与C混合编程" class="headerlink" title="汇编与C混合编程"></a>汇编与C混合编程</h1><h2 id="汇编调用C语言"><a href="#汇编调用C语言" class="headerlink" title="汇编调用C语言"></a>汇编调用C语言</h2><ul>
<li><p>ATPCS：</p>
<blockquote>
<ul>
<li><p><strong>参数传递</strong>：函数参数传递的时候，<strong>前4个参数通过r0 - r3来传递，超过4个的参数通过栈传递</strong></p>
</li>
<li><p><strong>函数返回</strong>：函数返回值通过 r0 带回</p>
</li>
</ul>
</blockquote>
</li>
<li><p><strong>注意：！！！调用C语言之前，必须先设置SP</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs asm">mov r0, #3<br>mov r1, #5<br>ldr sp, =0x40001ff0 	@!!! 必须设置sp<br>bl add //add是.c文件中的一个函数<br></code></pre></div></td></tr></table></figure></li>
</ul>
<h2 id="C语言中内嵌汇编-—-GCC编译器为例"><a href="#C语言中内嵌汇编-—-GCC编译器为例" class="headerlink" title="C语言中内嵌汇编 — GCC编译器为例"></a>C语言中内嵌汇编 — GCC编译器为例</h2><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-keyword">asm</span> (<br>	<span class="hljs-string">&quot;指令1\n&quot;</span><br>    <span class="hljs-string">&quot;指令2\n&quot;</span><br>    ...<br>    :输出列表<br>    :输入列表<br>    :修改列表(通用的寄存器)<br>);<br></code></pre></div></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-keyword">int</span> c;<br><span class="hljs-keyword">int</span> d;<br><br><span class="hljs-comment">//输出列表 --- 将寄存器值输出到C变量</span><br>:<span class="hljs-string">&quot;=r&quot;</span>(c), <span class="hljs-string">&quot;=r&quot;</span>(d)<br>    <br><span class="hljs-comment">//输入列表 ---- 将C变量输入到寄存器</span><br><span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">int</span> b = <span class="hljs-number">10</span>;<br><br>:<span class="hljs-string">&quot;r&quot;</span>(a), <span class="hljs-string">&quot;r&quot;</span>(b)<br>    <br><span class="hljs-comment">//修改列表 ---- 在内联汇编的时候，发生修改的寄存器</span><br>:<span class="hljs-string">&quot;r0&quot;</span>, <span class="hljs-string">&quot;r1&quot;</span>, <span class="hljs-string">&quot;r2&quot;</span><br></code></pre></div></td></tr></table></figure>

<p><strong>C变量的引用， 从输出列表到输入列表开始编号：第一个C变量%0，第二个C变量 %1….</strong></p>
<h1 id="Volatile关键字-（重点）"><a href="#Volatile关键字-（重点）" class="headerlink" title="Volatile关键字 （重点）"></a>Volatile关键字 （重点）</h1><h2 id="gcc优化"><a href="#gcc优化" class="headerlink" title="gcc优化"></a>gcc优化</h2><h3 id="优化思想"><a href="#优化思想" class="headerlink" title="优化思想"></a>优化思想</h3><ul>
<li>如果之前已经把变量的对应的内存数据读到寄存器中，当需要再次读取该变量所对应的内存数据的时候，为了提高效率，编译器会直接使用上一次寄存器中的值，而不再重新从内存读值</li>
</ul>
<h3 id="优化级别"><a href="#优化级别" class="headerlink" title="优化级别"></a>优化级别</h3><ul>
<li>O1：一级优化</li>
<li>O2（speed）/Os（size）：二级优化</li>
<li>O3：三级优化</li>
</ul>
<h3 id="优化的问题"><a href="#优化的问题" class="headerlink" title="优化的问题"></a>优化的问题</h3><p>如果内存中的值，已经被其他的执行单元（比如其他线程、中断）进行了更改，而优化后的代码，每次从寄存器读值，就会造成寄存器中的值和内存中的值不一致的问题</p>
<h2 id="Volatile的作用"><a href="#Volatile的作用" class="headerlink" title="Volatile的作用"></a>Volatile的作用</h2><p>volatile修饰一个变量，<strong>防止编译器优化（本质）</strong>，告诉编译器每次使用该变量时，必须从变量所在的内存重新读值</p>
<ul>
<li><p>有中断处理函数的代码，使用了全局变量，需要注意什么问题？</p>
<blockquote>
<p>定义全局变量的时候，<strong>需要加volatile修饰</strong></p>
</blockquote>
</li>
</ul>
<h1 id="ARM-编程命令"><a href="#ARM-编程命令" class="headerlink" title="ARM 编程命令"></a>ARM 编程命令</h1><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs assembly">arm-none-eabi-gcc -c .\start.s -o .\start.o  //只编译不链接<br>arm-none-eabi-gcc -c .\key_led.c -o .\key_led.o<br>arm-none-eabi-ld -Ttext=0x40000000 .\start.o .\key_led.o -o key_led.elf //链接，指定链接地址<br>arm-none-eabi-objcopy -O binary .\key_led.elf .\key_led.bin //格式转换，去除elf信息头<br></code></pre></div></td></tr></table></figure>



<h1 id="PWM定时器"><a href="#PWM定时器" class="headerlink" title="PWM定时器"></a>PWM定时器</h1><h2 id="PWM-脉冲宽度调制"><a href="#PWM-脉冲宽度调制" class="headerlink" title="PWM 脉冲宽度调制"></a>PWM 脉冲宽度调制</h2><img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/PWM Timer.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />

<img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/pwm.gif" srcset="/img/loading.gif" lazyload style="zoom:150%;" />

<p>FS4412开发板中，PWM的时钟频率为 100MHz</p>
<p>三星的计数器是递减计数器</p>
<h1 id="串口通信接口"><a href="#串口通信接口" class="headerlink" title="串口通信接口"></a>串口通信接口</h1><h2 id="电平标准-—-外部的硬件电路决定"><a href="#电平标准-—-外部的硬件电路决定" class="headerlink" title="电平标准 — 外部的硬件电路决定"></a>电平标准 — 外部的硬件电路决定</h2><img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/RS232、RS485.png" srcset="/img/loading.gif" lazyload  />

<h2 id="RS232-和-RS485-（重点）"><a href="#RS232-和-RS485-（重点）" class="headerlink" title="RS232 和 RS485 （重点）"></a>RS232 和 RS485 （重点）</h2><p> <strong>RS232 vs RS485</strong></p>
<ul>
<li>RS232  三个线(RXD,TXD,GND), 全双工，交叉连接<br>RS485  三个线(A,B,GND),         半双工，A-A；B-B</li>
<li>RS485 传输距离更远</li>
<li>RS485 速度更快</li>
<li>RS485 抗干扰更好，RS485采用传输差分信号，A-B线电压差确定传输的一位数据</li>
<li>RS232 1: -(3<del>15v)  0: +(3</del>15)v  , RS485  1: +(2<del>6v)  0: -(2</del>6v)</li>
<li>RS485支持多点通信，RS232不支持</li>
</ul>
<h2 id="UART-—-芯片内部的异步收发器"><a href="#UART-—-芯片内部的异步收发器" class="headerlink" title="UART — 芯片内部的异步收发器"></a>UART — 芯片内部的异步收发器</h2><ul>
<li>UART— 芯片内部的串口通信标准的数据发送格式</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/UART.png" srcset="/img/loading.gif" lazyload style="zoom: 67%;" />

<p>UART （Universal Asynchronous Receiver and Transmitter）—- 通用异步收发器</p>
<p>串口:数据是一位一位的发<br>并口:数据是多位一起发</p>
<ul>
<li><p>UART串口通信参数：</p>
<blockquote>
<ul>
<li>波特率 ：双方的通信速度</li>
<li>数据位：发送数据的位数 —- 先发送低位</li>
<li>停止位：表示收发停止</li>
<li>校验位：检查数据是否错误，奇偶校验（只能发现一位错误）</li>
<li>流量控制：需要硬件支持</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="串口通信数据错误："><a href="#串口通信数据错误：" class="headerlink" title="串口通信数据错误："></a>串口通信数据错误：</h3><ul>
<li>电平标准</li>
<li>波特率</li>
<li>数据位</li>
<li>停止位</li>
<li>校验位</li>
</ul>
<h3 id="系统三大总线"><a href="#系统三大总线" class="headerlink" title="系统三大总线"></a>系统三大总线</h3><p>数据、地址、控制</p>
<h3 id="DMA模式"><a href="#DMA模式" class="headerlink" title="DMA模式"></a>DMA模式</h3><p>Direct Memory Access：设备直接访问内存，不需要经过CPU</p>
<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><ul>
<li><p>异常处理流程</p>
<blockquote>
<p>​                                                                      <img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/Expection Handling.png" srcset="/img/loading.gif" lazyload style="zoom: 80%;" /></p>
</blockquote>
</li>
</ul>
<h2 id="ARM核硬件上自动做的事情"><a href="#ARM核硬件上自动做的事情" class="headerlink" title="ARM核硬件上自动做的事情"></a>ARM核硬件上自动做的事情</h2><ul>
<li><p>CPSR —-拷贝—-&gt; SPSR</p>
</li>
<li><p>设置CPSR对应位：</p>
<blockquote>
<ul>
<li>进入ARM态</li>
<li>进入对应的异常模式</li>
<li>禁止中断</li>
</ul>
</blockquote>
</li>
<li><p>保存PC的值到异常模式的 LR</p>
</li>
<li><p>将PC设置为异常向量表的对应位置：</p>
<blockquote>
<table>
<thead>
<tr>
<th>偏移量</th>
<th>异常</th>
</tr>
</thead>
<tbody><tr>
<td>0x1C</td>
<td>FIQ</td>
</tr>
<tr>
<td>0x18</td>
<td>IRQ</td>
</tr>
<tr>
<td>0x14</td>
<td>(Reserved)</td>
</tr>
<tr>
<td>0x10</td>
<td>Data Abort</td>
</tr>
<tr>
<td>0x0C</td>
<td>Prefetch Abort</td>
</tr>
<tr>
<td>0x08</td>
<td>Software Interrupt</td>
</tr>
<tr>
<td>0x04</td>
<td>Undefined Instruction</td>
</tr>
<tr>
<td>0x00</td>
<td>Reset</td>
</tr>
</tbody></table>
<p>&lt;Vector Table&gt;</p>
</blockquote>
</li>
<li><p>异常优先级、对应处理器模式、返回地址：</p>
<blockquote>
<table>
<thead>
<tr>
<th>优先级</th>
<th>异常</th>
<th>模式</th>
<th>返回地址</th>
</tr>
</thead>
<tbody><tr>
<td>1  最高</td>
<td>Reset</td>
<td>SVC</td>
<td>-</td>
</tr>
<tr>
<td>2</td>
<td>Data Abort</td>
<td>Abort</td>
<td>LR-8</td>
</tr>
<tr>
<td>3</td>
<td>FIQ</td>
<td>FIQ</td>
<td>LR-4</td>
</tr>
<tr>
<td>4</td>
<td>IRQ</td>
<td>IRQ</td>
<td>LR-4</td>
</tr>
<tr>
<td>5</td>
<td>Prefetch Abort</td>
<td>Abort</td>
<td>LR-4</td>
</tr>
<tr>
<td>6</td>
<td>Software Interrupt</td>
<td>SVC</td>
<td>LR</td>
</tr>
<tr>
<td>7   最低</td>
<td>Undefined Instruction</td>
<td>Undefined</td>
<td>LR</td>
</tr>
</tbody></table>
</blockquote>
</li>
</ul>
<h2 id="程序员需要做的事情"><a href="#程序员需要做的事情" class="headerlink" title="程序员需要做的事情"></a>程序员需要做的事情</h2><ul>
<li><p>设置异常向量表（在异常向量表中，写跳转指令，跳转指定异常处理函数）</p>
</li>
<li><p>告诉ARM核异常向量表的基地址</p>
<blockquote>
<ul>
<li>cortex-A系列以前，异常向量表可以存放在 0x0000，0000 （低地址）或 0xffff，0000（高地址）；cp15（协处理器）.c1（寄存器）决定异常向量表存放在高地址还是低地址</li>
<li>cortex-A系列以后，异常向量表可以在任意位置，cp15.c12保存异常向量表的基地址</li>
</ul>
</blockquote>
</li>
<li><p>编写异常处理函数：</p>
<blockquote>
<ul>
<li><p>设置SP寄存器</p>
</li>
<li><p>将通用寄存器R0~R12，进行压栈保护</p>
</li>
<li><p>异常处理</p>
</li>
<li><p>异常返回</p>
<blockquote>
<ul>
<li>恢复R0~R12 （出栈）</li>
<li>恢复CPSR</li>
<li>恢复PC</li>
</ul>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
<h1 id="中断处理"><a href="#中断处理" class="headerlink" title="中断处理"></a>中断处理</h1><ul>
<li><p>CPU主要两种工作模式：轮询和中断</p>
<blockquote>
<ul>
<li>轮询：不断询问是否要处理事情，但很多时候不满足条件，浪费了CPU的时间</li>
<li>中断方式：当需要CPU处理的时候，产生一个信号，打断CPU正在做的事情，让CPU处理当前的事情，处理完后，回到打断之前的地方继续执行</li>
</ul>
</blockquote>
</li>
<li><p>中断处理注意点：</p>
<blockquote>
<ul>
<li>中断打断其他程序的执行，所以中断处理要尽可能的快，不能中断处理耗时过长</li>
<li>中断打断程序的执行，所以中断处理的时候，需要先保存现场（CPU的状态和CPU内部寄存器的值：压栈保存），中断处理结束，恢复现场</li>
</ul>
</blockquote>
</li>
</ul>
<h2 id="中断的五大概念（重点）"><a href="#中断的五大概念（重点）" class="headerlink" title="中断的五大概念（重点）"></a>中断的五大概念（重点）</h2><ul>
<li><p>中断源：产生中断的源头</p>
</li>
<li><p>中断号：SOC芯片厂家对SOC芯片内部<strong>中断源的编号</strong></p>
</li>
<li><p>中断处理函数：中断产生后，需要调用执行的函数</p>
</li>
<li><p>中断控制器：控制中断的优先级、中断是否被允许产生</p>
</li>
<li><p>内部中断和外部中断：</p>
<blockquote>
<ul>
<li><p>内部中断：SOC芯片内部控制器产生的中断</p>
</li>
<li><p>外部中断：SOC芯片外部管脚通过电平触发产生的中断</p>
<blockquote>
<p>高电平触发、低电平触发</p>
<p>上升沿触发、下降沿触发</p>
<p>双边触发</p>
</blockquote>
</li>
</ul>
</blockquote>
</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/interrupt.png" srcset="/img/loading.gif" lazyload style="zoom: 80%;" />

<p>学习使用的FS4412开发板，是三星设计的SOC，一共有160个中断源</p>
<h2 id="中断处理过程"><a href="#中断处理过程" class="headerlink" title="中断处理过程"></a>中断处理过程</h2><ul>
<li><em><strong>中断处理过程</strong></em>：</li>
</ul>
<img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/interrupt_handling.png" srcset="/img/loading.gif" lazyload style="zoom: 60%;" />

<ul>
<li><em><strong>MPCore 分布式中断控制系统</strong></em></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/MPCore.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><em><strong>GIC：</strong></em> (Generic Interrupt Controller)</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/GIC.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="A-D转换器"><a href="#A-D转换器" class="headerlink" title="A/D转换器"></a>A/D转换器</h1><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;exynos_4412.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;exynos_setup.h&quot;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">adc_handler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    CLRINTADC = <span class="hljs-number">0x0</span>; <span class="hljs-comment">//INT_ADCn interrupt clear. Cleared if any value is written.</span><br><br>    <span class="hljs-keyword">int</span> data = ADCDAT &amp; <span class="hljs-number">0xfff</span>;<br>    <span class="hljs-keyword">int</span> v = (<span class="hljs-number">1800</span> * data) / <span class="hljs-number">0xfff</span>;<br><br>    uart_printf(<span class="hljs-string">&quot;%d : %d mv\r\n&quot;</span>, data, v);<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">	   1.8v    0xfff</span><br><span class="hljs-comment">	    x      data  </span><br><span class="hljs-comment">	 */</span><br>    delay_time(<span class="hljs-number">3</span>);<br><br>    <span class="hljs-comment">// A/D conversion starts by enable.</span><br>    ADCCON |= (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">0</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">adc_interrupt_init</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//1.init ADC</span><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    16bit 1: 12bit A/D conversion</span><br><span class="hljs-comment">    14bit 1: enable A/D converter prescaler</span><br><span class="hljs-comment">    6¬13bit 132: prescaler value data</span><br><span class="hljs-comment">    ADCMUX 0x3: Analog input channel select</span><br><span class="hljs-comment">    */</span><br>    ADCCON = (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">16</span>) | (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">14</span>) | (<span class="hljs-number">132</span> &lt;&lt; <span class="hljs-number">6</span>);<br>    ADCMUX = <span class="hljs-number">0x3</span>;<br>    <span class="hljs-comment">//2.init GIC</span><br>    request_irq(<span class="hljs-number">42</span>, adc_handler);<br>    <span class="hljs-comment">//3.init ARM</span><br>    enable_irq();<br>    <span class="hljs-comment">//4.init Combiner</span><br>    INTCOMBINER.IESR2 |= (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">19</span>);<br>    <span class="hljs-comment">//5.A/D conversion starts by enable.</span><br>    ADCCON |= (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">0</span>);<br><br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">adc_interrupt_test</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    adc_interrupt_init();<br><br>    <span class="hljs-comment">//do_something();</span><br>    <br>&#125;<br></code></pre></div></td></tr></table></figure>

<h1 id="IIC"><a href="#IIC" class="headerlink" title="IIC"></a>IIC</h1><h2 id="IIC总线"><a href="#IIC总线" class="headerlink" title="IIC总线"></a>IIC总线</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>IIC（Inter-Integrated Circuit,又称 IIC）—- 由PHILIPS公司开发的<strong>串口总线，用于连接微控制器及其外围设备</strong></p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><blockquote>
<ul>
<li>只有<strong>两条总线线路</strong>:一条串行数据线**(SDA),<strong>一条串行时钟线</strong>(SCL)** </li>
<li>每个连接到总线的器件都可以使用软件<strong>根据它的唯一的地址来识别</strong> </li>
<li>传输数据的设备间是简单的<strong>主/从关系</strong> </li>
<li>主机可以用作主机发送器或主机接收器 </li>
<li>它是一个真正的多主机总线，<strong>两个或多个主机同时发起数据传输时，可以通过冲突检测和仲裁来防止数据被破坏</strong></li>
<li><strong>串行的8位双向数据传输</strong>，<strong>先发送高位</strong>，位速率在标准模式下可达100kbit/s,在快速模式下可达400kbit/s,在高速模式下可达3.4Mbit/s</li>
</ul>
</blockquote>
<h3 id="IIC总线信号类型"><a href="#IIC总线信号类型" class="headerlink" title="IIC总线信号类型"></a>IIC总线信号类型</h3><p>有3种类型信号：<strong>开始信号、结束信号、响应信号</strong></p>
<blockquote>
<ol>
<li>开始信号(S):SCL 为高电平时，SDA 由高电平向低电平跳变，开始传送数据 </li>
<li>结束信号(P):SCL 为高电平时，SDA 由低电平向高电平跳变，结束传送数据 </li>
<li>响应信号(ACK):接收器在接收到8位数据后，在第9个时钟周期，拉低 SDA 电平 </li>
</ol>
</blockquote>
<p><strong>注意:   SDA 上传输的数据必须在 SCL 为高电平期间保持稳定，SDA 上的数据只能在 SCL 为低电平期间变化</strong></p>
  <img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/IIC_Bus.png" srcset="/img/loading.gif" lazyload alt="IIC signal" style="zoom: 67%;" />

<h3 id="IIC-总线的数据传输格式"><a href="#IIC-总线的数据传输格式" class="headerlink" title="IIC 总线的数据传输格式"></a>IIC 总线的数据传输格式</h3><p>发送到 <strong>SDA 线上的每个字节必须是8位的，每次传输可以发送的字节数量不受限制。首先传输的是数据的最高位(MSB)</strong></p>
<p><strong>启动一个传输时，主机先发送 S 信号，然后发出8位数据。这8位数据中前7位为从机的地址，第8位表示传输的方向(0表示写操作，1表示读操作)。从机收到后会发出一个 ACK 信号</strong></p>
<p><em><strong>Read Sequence</strong></em> </p>
<blockquote>
<img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/IIC_ReadSequence.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</blockquote>
<p><em><strong>Write Sequence</strong></em></p>
<blockquote>
<img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/IIC_WriteSequence.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />
</blockquote>
<p><strong>I^2^C Terms</strong></p>
<table>
<thead>
<tr>
<th>Signal</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>S</td>
<td>Start Condition: SDA goes from high to low while SCL is high</td>
</tr>
<tr>
<td>AD</td>
<td>Slave I^2^C address</td>
</tr>
<tr>
<td>W</td>
<td>Write bit (0)</td>
</tr>
<tr>
<td>R</td>
<td>Read bit (1)</td>
</tr>
<tr>
<td>ACK</td>
<td>Acknowledge: SDA line is low while the SCL line is high at the 9 ^th^ clock cycle</td>
</tr>
<tr>
<td>NACK</td>
<td>Not-Acknowledge: SDA line stays high at the 9th clock cycle</td>
</tr>
<tr>
<td>RA</td>
<td>MPU-60X0 internal register address</td>
</tr>
<tr>
<td>DATA</td>
<td>Transmit or received data</td>
</tr>
<tr>
<td>P</td>
<td>Stop condition: SDA going from low to high while SCL is high</td>
</tr>
</tbody></table>
<p><strong>操作芯片的步骤：</strong></p>
<ul>
<li>通过原理图或手册，确定通信接口</li>
<li>确定是IIC或者是其他通信方式之后，找到从机地址（或者其他对应的地址信息）</li>
<li>查看手册确定寄存器操作方式（读写）</li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%BA%95%E5%B1%82%E5%BC%80%E5%8F%91/">底层开发</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/ARM/">ARM</a>
                    
                      <a class="hover-with-bg" href="/tags/%E5%BA%95%E5%B1%82%E5%BC%80%E5%8F%91/">底层开发</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/Git-Command/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Git常用命令</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/Cpp-Note01/">
                        <span class="hidden-mobile">C++语法笔记</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"ymqRfRF4KqPviKTrJxtv3Tm2-gzGzoHsz","appKey":"LGXIPfn36xtzCvL8XrGGCuzA","path":"window.location.pathname","placeholder":"相遇即是缘分，说点什么再走吧~(/≧▽≦)/","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          Fluid.plugins.initFancyBox('#valine .vcontent img:not(.vemoji)');
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <i class="iconfont icon-copyright"></i> 2022 闲卧庭前远看帆 </br> 封面及部分配图源自互联网 仅作美化之用 版权归图片原作者所有 如有侵权请通过关于页头像下方邮箱联系 侵权作品会被删除</br> Powered by <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> Theme <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-love"></i>
<div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":1},"log":false});</script></body>
</html>
