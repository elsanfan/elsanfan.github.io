

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="课程内容 ：

怎么移植一个系统到开发板，怎么编译系统内核、怎么制作设备树文件、怎么制作文件系统
制作bootloader（u_boot为例）

必须掌握以上的这些工程方法">
  <meta name="author" content="闲卧庭前远看帆">
  <meta name="keywords" content="">
  <meta name="description" content="课程内容 ：  怎么移植一个系统到开发板，怎么编译系统内核、怎么制作设备树文件、怎么制作文件系统 制作bootloader（u_boot为例）  必须掌握以上的这些工程方法">
<meta property="og:type" content="article">
<meta property="og:title" content="系统移植笔记">
<meta property="og:url" content="https://code.阿帆的小窝.top/2022/System-Transplantion/index.html">
<meta property="og:site_name" content="闲卧庭前远看帆的博客">
<meta property="og:description" content="课程内容 ：  怎么移植一个系统到开发板，怎么编译系统内核、怎么制作设备树文件、怎么制作文件系统 制作bootloader（u_boot为例）  必须掌握以上的这些工程方法">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/System_Start.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/uImage_loading.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/Go_command.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/bootm_command.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/Linux_Kernel_Compile.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/Linux_Boot_Process.png">
<meta property="article:published_time" content="2022-05-28T09:56:38.000Z">
<meta property="article:modified_time" content="2022-06-06T11:16:13.213Z">
<meta property="article:author" content="闲卧庭前远看帆">
<meta property="article:tag" content="ARM">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="系统移植">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/System_Start.png">
  
  <title>系统移植笔记 - 闲卧庭前远看帆的博客</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/atom-one-dark.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"code.xn--yetp9bp76b6xdqv7b.top","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":80,"cursorChar":"|","loop":true},"anchorjs":{"enable":false,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"#"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":3},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 100vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>闲卧庭前远看帆の博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                主页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-books"></i>
                文章
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/">
                    
                    分类
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/archives/">
                    
                    归档
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/tags/">
                    
                    标签
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo@main/img/morncolour05.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="系统移植笔记">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      闲卧庭前远看帆
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-05-28 17:56" pubdate>
        2022年5月28日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      16k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      51 分钟
    </span>
  

  
  
</div>

            
          </div>

          
            <div class="scroll-down-bar">
              <i class="iconfont icon-arrowdown"></i>
            </div>
          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">系统移植笔记</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2022年6月6日 晚上
                
              </p>
            
            <div class="markdown-body">
              <p>课程内容 ：</p>
<ol>
<li>怎么移植一个系统到开发板，怎么编译系统内核、怎么制作设备树文件、怎么制作文件系统</li>
<li>制作bootloader（u_boot为例）</li>
</ol>
<p>必须掌握以上的这些工程方法</p>
<span id="more"></span>

<h1 id="PC-和-嵌入式设备-系统启动比较"><a href="#PC-和-嵌入式设备-系统启动比较" class="headerlink" title="PC 和 嵌入式设备 系统启动比较"></a>PC 和 嵌入式设备 系统启动比较</h1><h2 id="PC机启动过程"><a href="#PC机启动过程" class="headerlink" title="PC机启动过程"></a>PC机启动过程</h2><blockquote>
<ol>
<li><strong>BIOS</strong> (Basic Inpu Output System)     ( 硬件初始化 : 系统时钟，内存(SDRAM/DDR2/DDR3/DDR4)，启动方式:USB 硬盘 光驱 …)</li>
<li><strong>引导程序</strong> (grub,lilo,…) =&gt;加载操作系统</li>
<li><strong>OS</strong>       (windows,Linux,Mac os)</li>
<li><strong>挂载文件系统</strong> ( NTFS, FAT(16/32), EXT(2,3,4) )</li>
<li><strong>应用程序</strong></li>
</ol>
</blockquote>
<h2 id="嵌入式设备（exynos4412）"><a href="#嵌入式设备（exynos4412）" class="headerlink" title="嵌入式设备（exynos4412）"></a>嵌入式设备（exynos4412）</h2><blockquote>
<ol>
<li><p>iROM固化代码</p>
<blockquote>
<ul>
<li><p>基本硬件初始化</p>
</li>
<li><p>判别启动方式—(SD/USB/EMMC)</p>
</li>
<li><p>读取存储介质<strong>一部分数据</strong>到 iRAM </p>
</li>
</ul>
</blockquote>
</li>
<li><p>iRAM代码运行bootloader<strong>第一阶段</strong></p>
<blockquote>
<ul>
<li>初始化系统时钟</li>
<li>初始化内存</li>
<li>自搬移bootloader到内存</li>
</ul>
</blockquote>
</li>
<li><p>内存中运行bootloader<strong>第二阶段</strong></p>
<blockquote>
<ul>
<li><p>初始化基本的硬件设备  (串口,EMMC,SD)</p>
</li>
<li><p>加载OS到内存</p>
</li>
</ul>
</blockquote>
</li>
<li><p>内存中运行操作系统  (Linux,windows CE,Mac OS)</p>
</li>
<li><p>挂载文件系统 </p>
</li>
<li><p>运行应用程序 </p>
</li>
</ol>
</blockquote>
<p><strong>bootloader = BIOS + 引导程序</strong></p>
<img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/System_Start.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />

<table>
<thead>
<tr>
<th>Item</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>iROM</td>
<td>internal Read-Only Memory — 掉电后数据保留</td>
</tr>
<tr>
<td>iRAM</td>
<td>internal Random-Access Memory — 掉电后数据丢失</td>
</tr>
<tr>
<td>LPDDR</td>
<td>Low-Power Double Data Rate （SDRAM —- Synchronous Dynamic Random-Access Memory）</td>
</tr>
<tr>
<td>eMMC</td>
<td>Embedded Multi Media Card</td>
</tr>
</tbody></table>
<h1 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h1><ul>
<li><p>硬件：fs4412开发板 — Samsung Exynos芯片</p>
</li>
<li><p>PC机环境：Ubuntu 16.04</p>
</li>
<li><p>交叉开发概念：</p>
<blockquote>
<p>在PC机完成代码的编写和编译，在开发板运行编译完成的程序</p>
</blockquote>
</li>
</ul>
<h1 id="Linux-环境配置"><a href="#Linux-环境配置" class="headerlink" title="Linux 环境配置"></a>Linux 环境配置</h1><h2 id="在-Linux-上添加交叉开发工具链"><a href="#在-Linux-上添加交叉开发工具链" class="headerlink" title="在 Linux 上添加交叉开发工具链"></a>在 Linux 上添加交叉开发工具链</h2><ul>
<li>方式一：在当前终端添加环境变量</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:TOOL_CHAIN <br><span class="hljs-comment"># TOOL_CHAIN 是交叉开发工具链的绝对路径</span><br><span class="hljs-comment"># 这种方式仅对当前终端有效</span><br></code></pre></div></td></tr></table></figure>

<ul>
<li><p>方式二：添加环境变量到配置文件 （<strong>选择这种</strong>）</p>
<blockquote>
<ul>
<li>/home/linux (用户名）/.bashrc —– (针对当前登录用户)   </li>
<li>/etc/bash.bashrc —- (所有用户有效)  （<strong>选这个</strong>）</li>
</ul>
</blockquote>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo vi /etc/bash.bashrc<br><span class="hljs-comment"># 在文件末尾添加</span><br>TOOL_CHAIN=/home/linux/fs4412/toolchain/gcc-4.6.4/bin<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$TOOL_CHAIN</span><br><span class="hljs-comment"># TOOL_CHAIN 根据自己工具链文件的绝对路径，每个人不一样</span><br></code></pre></div></td></tr></table></figure>

<p>如果是64bit 的Ubuntu系统，需要安装32bit运行库：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo apt install lib32ncurses5<br>sudo apt install lib32z1<br></code></pre></div></td></tr></table></figure>



<h2 id="Linux-服务配置"><a href="#Linux-服务配置" class="headerlink" title="Linux 服务配置"></a>Linux 服务配置</h2><h3 id="配置tftp服务-（文件传输）"><a href="#配置tftp服务-（文件传输）" class="headerlink" title="配置tftp服务 （文件传输）"></a>配置tftp服务 （文件传输）</h3><ol>
<li><p>安装软件包：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo apt-get install tftp-hpa  (客户端程序)<br>sudo apt-get install tftpd-hpa （服务端程序）<br></code></pre></div></td></tr></table></figure></li>
<li><p>修改默认配置文件  /etc/default/tftp-hpa </p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo vi /etc/default/tftp-hpa<br><span class="hljs-comment"># 修改 TFTP_DIRECTORY=&quot;自己的tftpboot路径&quot;</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>重启tftp 服务</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo /etc/init.d/tftpd-hpa restart<br><span class="hljs-comment"># 或者</span><br>sudo service tftpd-hpa restart<br></code></pre></div></td></tr></table></figure></li>
<li><p>测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">tftp 127.0.0.1 (server IP)<br>tftp&gt; get (下载文件)<br>tftp&gt; quit<br></code></pre></div></td></tr></table></figure></li>
</ol>
<h3 id="配置nfs-（network-file-system）服务"><a href="#配置nfs-（network-file-system）服务" class="headerlink" title="配置nfs （network file system）服务"></a>配置nfs （network file system）服务</h3><ol>
<li><p>安装软件包:</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo apt-get install nfs-kernel-server<br></code></pre></div></td></tr></table></figure></li>
<li><p>修改默认配置文件 /etc/exports</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo vi /etc/exports<br><span class="hljs-comment"># 添加自己电脑上需要共享的目录路径</span><br>/home/linux/fs4412/rootfs *(rw,sync,no_root_squash)<br><span class="hljs-comment"># *前面有空格，*后面部分代表目录的权限设置</span><br><span class="hljs-comment"># rw : 读写权限</span><br><span class="hljs-comment"># sync : 文件同步</span><br><span class="hljs-comment"># no_root_squash : 不对root用户进行权限压缩</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>重新启动nfs服务</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo /etc/init.d/nfs-kernel-server restart<br><span class="hljs-comment"># 或者</span><br>sudo service nfs-kernel-server restart<br></code></pre></div></td></tr></table></figure></li>
<li><p>测试:</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo mount IP:共享路径  自己的挂载点目录<br><span class="hljs-comment"># e.g.</span><br>sudo mount 127.0.0.1:/home/linux/fs4412/rootfs  ./nfs<br><span class="hljs-comment"># ./nfs (自己电脑上当前目录下的nfs子目录)</span><br><br>sudo umount ./nfs<br><span class="hljs-comment"># 撤销对nfs目录的挂载</span><br></code></pre></div></td></tr></table></figure></li>
</ol>
<h1 id="开发板环境配置"><a href="#开发板环境配置" class="headerlink" title="开发板环境配置"></a>开发板环境配置</h1><h2 id="u-boot-常用命令"><a href="#u-boot-常用命令" class="headerlink" title="u_boot 常用命令"></a>u_boot 常用命令</h2><ol>
<li><p>设置开发板ip地址</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">setenv ipaddr [ip]<br><span class="hljs-built_in">print</span> 查看板子环境信息<br>save 记得保存<br></code></pre></div></td></tr></table></figure></li>
<li><p>设置tftp 服务器的ip地址</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">setenv serverip [server IP] <br></code></pre></div></td></tr></table></figure></li>
<li><p>开发板和Ubuntu之间进行网络通信 （板子 Ping Ubuntu）</p>
<blockquote>
<p>&lt;1&gt;板子IP地址和Ubuntu的IP地址的网络号一样<br>&lt;2&gt;虚拟机桥接模式<br>&lt;3&gt;无线网卡禁用<br>&lt;4&gt;防火墙关闭</p>
</blockquote>
</li>
<li><p>用tftp服务，下载Linux 系统、设备树（硬件信息）、文件系统 到开发板上</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">tftp 41000000 uImage  <br>tftp 42000000 exynos4412-fs4412.dtb<br>tftp 43000000 ramdisk.img<br></code></pre></div></td></tr></table></figure></li>
<li><p>启动内存</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">bootm 内核在内存地址  ramdisk在内存地址  设备树在内存地址<br>bootm 41000000  43000000   42000000<br></code></pre></div></td></tr></table></figure></li>
</ol>
<h1 id="挂载文件系统"><a href="#挂载文件系统" class="headerlink" title="挂载文件系统"></a>挂载文件系统</h1><h2 id="网络方式加载Linux内核-开发阶段"><a href="#网络方式加载Linux内核-开发阶段" class="headerlink" title="网络方式加载Linux内核(开发阶段)"></a>网络方式加载Linux内核(开发阶段)</h2><ol>
<li><p>查看已经设置的参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">print</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>设置tftp 服务器端 ip 地址：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">setenv serverip 192.168.154.178<br></code></pre></div></td></tr></table></figure></li>
<li><p>设置开发班开启后自动执行的命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">setenv bootcmd tftp 41000000 uImage\;tftp 42000000 exynos4412-fs4412.dtb\;bootm 41000000 - 42000000<br></code></pre></div></td></tr></table></figure>

<p><code>bootm 41000000 - 42000000</code>  : 分别代表 Linux系统地址、文件系统地址（“-”：表示不在本地内存地址加载）、设备树地址</p>
</li>
<li><p>告诉操作系统系统启动后，挂载文件系统的方式 （网络方式挂载）</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">setenv bootargs root=/dev/nfs nfsroot=192.168.154.178:/home/linux/03.fs4412/rootfs,proto=tcp,nfsvers=3,nolock  rw console=ttySAC2,115200  init=/linuxrc  ip=192.168.154.126<br></code></pre></div></td></tr></table></figure></li>
<li><p>保存设置好的环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">save<br></code></pre></div></td></tr></table></figure></li>
</ol>
<h2 id="从EMMC加载内核和文件系统-产品发布阶段"><a href="#从EMMC加载内核和文件系统-产品发布阶段" class="headerlink" title="从EMMC加载内核和文件系统(产品发布阶段)"></a>从EMMC加载内核和文件系统(产品发布阶段)</h2><ol>
<li><p>烧写内核镜像到EMMC上</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment">#下载到内存</span><br>tftp  41000000  uImage <br><span class="hljs-comment">#将内存的数据写到EMMC</span><br>movi  write  kernel  41000000 <br></code></pre></div></td></tr></table></figure></li>
<li><p>烧写设备树文件到EMMC上</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">tftp  41000000  exynos4412-fs4412.dtb  <br>movi  write  dtb  41000000  <br></code></pre></div></td></tr></table></figure></li>
<li><p>烧写文件系统镜像到EMMC上</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">tftp  41000000  ramdisk.img<br>movi  write  rootfs  41000000  300000(大小)<br></code></pre></div></td></tr></table></figure></li>
<li><p>设置启动参数</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">setenv bootcmd movi <span class="hljs-built_in">read</span> kernel 41000000\;movi <span class="hljs-built_in">read</span> dtb 42000000\;movi <span class="hljs-built_in">read</span> rootfs 43000000 300000\;bootm 41000000 43000000 42000000<br>saveenv<br></code></pre></div></td></tr></table></figure></li>
</ol>
<h1 id="编译Linux-Kernel"><a href="#编译Linux-Kernel" class="headerlink" title="编译Linux Kernel"></a>编译Linux Kernel</h1><h2 id="Linux-Kernel-目录结构-（记忆）"><a href="#Linux-Kernel-目录结构-（记忆）" class="headerlink" title="Linux Kernel 目录结构 （记忆）"></a>Linux Kernel 目录结构 （记忆）</h2><ol>
<li><p>arch 目录 — 存放架构相关代码</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">arch/arm/boot/compressed <span class="hljs-comment">#存放的是内核的自解压代码</span><br>arch/arm/kernel/head.s <span class="hljs-comment">#Linux内核的开始代码</span><br>arch/arm/boot/dts 	<span class="hljs-comment">#存放开发板相关的设备树文件</span><br>arch/arm/configs  <span class="hljs-comment">#存放SOC芯片相关的内核配置文件</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>driver 目录 — 设备驱动代码</p>
</li>
<li><p>net 目录 — 网络协议栈的实现代码</p>
</li>
<li><p>Makefile 文件 — 指定平台信息和交叉开发工具链</p>
</li>
</ol>
<h2 id="针对自己的开发板配置Linux内核"><a href="#针对自己的开发板配置Linux内核" class="headerlink" title="针对自己的开发板配置Linux内核"></a>针对自己的开发板配置Linux内核</h2><h3 id="生成-uImage-文件"><a href="#生成-uImage-文件" class="headerlink" title="生成 uImage 文件"></a>生成 uImage 文件</h3><ol>
<li><p>修改 Makefile （不推荐）</p>
<figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile">ARCH  		?= arm<br>CROSS_COMPILE ?= arm-none-linux-guneabi-<br></code></pre></div></td></tr></table></figure></li>
<li><p>使用默认配置文件配置内核 （推荐）</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">make ARCH=arm exynos_defconfig 	(cp arch/arm/configs/exynos_defconfig  .config)<br></code></pre></div></td></tr></table></figure></li>
<li><p>通过配置菜单配置内核</p>
<ol>
<li><p>安装 libcurses 库</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo apt-get install libncurses5-dev<br></code></pre></div></td></tr></table></figure></li>
<li><p>```bash<br>make  ARCH=arm  menuconfig</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown"><br><span class="hljs-code">      y : 选中编译进行内核  n : 不编译进行内核 m : 编译成模块（会编译但不连接进入内核）</span><br><span class="hljs-code"></span><br><span class="hljs-code">      确认信息：</span><br><span class="hljs-code"></span><br><span class="hljs-code">      &gt; 1. 确认编译的内核是否是自己需要的</span><br><span class="hljs-code">      &gt; 2. 输出信息的串口</span><br><span class="hljs-code"></span><br><span class="hljs-code">      注意保存</span><br><span class="hljs-code"></span><br><span class="hljs-bullet">4.</span> 编译 Linux 内核<br><br>   <span class="hljs-code">```bash</span><br><span class="hljs-code">   make  ARCH=arm  CROSS_COMPILE=arm-none-linux-gnueabi-</span><br></code></pre></div></td></tr></table></figure></li>
</ol>
<p>编译完后有四个文件需要注意：</p>
<blockquote>
<ol>
<li><p><strong>vmlinux</strong> (60M) (elf linux内核镜像)(存放在Linux内核的顶层目录)</p>
</li>
<li><p><strong>Image</strong>   (5.5M)   (去掉elf头和调试信息之后的Linux内核镜像) arch/arm/boot</p>
</li>
<li><p><strong>vmlinux</strong> (3.0M)  (elf Linux内核镜像 : 自解压代码 + gzip压缩后的内核镜像) (arch/arm/boot/compressed  )                        </p>
</li>
<li><p><strong>zImage</strong>   (去掉elf头之后的Linux内核镜像 : 自解压代码 + gzip压缩后的内核镜像) arch/arm/boot</p>
</li>
</ol>
<p>arch/arm/boot:  2,4  </p>
</blockquote>
</li>
<li><p>生成uImage 格式 Linux 内核镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">make ARCH=arm  CROSS_COMPILE=arm-none-linux-gnueabi- uImage<br></code></pre></div></td></tr></table></figure>

<p>如果提示：mkimage找不到</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo apt install u-boot-tools <br></code></pre></div></td></tr></table></figure></li>
</ol>
<p>完成以上步骤，我们将制作好的 uImage 放到开发板，仍然不能正常启动，因为板<strong>子没有设置网卡驱动，没有办法通过 nfs 服务挂载文件系统</strong></p>
<h3 id="设置网卡驱动"><a href="#设置网卡驱动" class="headerlink" title="设置网卡驱动"></a>设置网卡驱动</h3><ol>
<li><p>通过配置菜单，配置内核</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">make ARCH=arm menuconfig<br></code></pre></div></td></tr></table></figure></li>
<li><p>选中以下项目 (前面有 * 号表示选中，Enter 进入子菜单，y 选中)</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">[*] Networking support ---&gt;<br>Networking options ---&gt;<br>&lt;*&gt; Packet socket<br>&lt;*&gt; Unix domain sockets<br>[*] TCP/IP networking<br>[*] IP: kernel level autoconfiguration<br>Device Drivers ---&gt;<br>[*] Network device support ---&gt;<br>[*] Ethernet driver support (NEW) ---&gt;<br>&lt;*&gt; DM9000 support<br>File systems ---&gt;<br>[*] Network File Systems (NEW) ---&gt;<br>&lt;*&gt; NFS client support<br>[*] NFS client support <span class="hljs-keyword">for</span> NFS version 3<br>[*] NFS client support <span class="hljs-keyword">for</span> the NFSv3 ACL protocol extension<br>[*] Root file system on NFS<br></code></pre></div></td></tr></table></figure></li>
<li><p>修改文件 <code>driver/clk/clk.c</code> — 关闭时钟，不关闭网卡起不来</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> clk_ignore_unused; <br><span class="hljs-comment">/*改为true*/</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> clk_ignore_unused = <span class="hljs-literal">true</span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>重新编译 uImage</p>
</li>
</ol>
<h2 id="uImage-加载地址分析"><a href="#uImage-加载地址分析" class="headerlink" title="uImage 加载地址分析"></a>uImage 加载地址分析</h2><img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/uImage_loading.png" srcset="/img/loading.gif" lazyload style="zoom:67%;" />

<ol>
<li><p>命令：</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">mkimage -l uImage<br>=&gt; &gt;读取uImage头的信息(判断uImage应该加载到内存的那个地址运行)<br><br>bootm  0x4100,0000(ram<span class="hljs-emphasis">_addr)   </span><br><span class="hljs-emphasis">	</span><br><span class="hljs-emphasis">uImage =&gt; head + zImage</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>头中记录的信息：</p>
<blockquote>
<ul>
<li>Load Address: 40008000 (期望加载的地址)</li>
<li>Entry Point:  40008000  / 40008040 (最终Linux运行的地址【PC寄存器记录的地址】)</li>
</ul>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">&lt;1&gt;从这个地址中读取了64byte头信息<br>&lt;2&gt;发现ram<span class="hljs-emphasis">_addr 和 load_</span>addr 不相等，此时会将41000000偏移64字节之后的zImage搬移到load address,然后将pc指向enty<span class="hljs-emphasis">_point 	 </span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis">bootm  0x40008000(ram_</span>addr)<br>uImage =&gt; head + zImage<br>&lt;===============================================================================================&gt;	<br>&lt;1&gt;从这个地址中读取64byte信息<br>&lt;2&gt;发现ram<span class="hljs-emphasis">_addr和load_</span>addr 相等,此时会将pc指针指向entry point<br><br>此时完蛋，因为0x40008000开始部分是64byte头信息数据，应该将pc指向 0x40008000 + 64byte头信息 <br></code></pre></div></td></tr></table></figure></li>
<li><p>总结：</p>
<blockquote>
<ul>
<li>如果uImage头信息中load address 和 enty point相等，此时uImage不能加载到load address地址运行</li>
<li>如果 uImage 头信息中load address 和 enty point不相等(偏移64byte),此时只能将uImage加载到 load address 运行。</li>
</ul>
</blockquote>
</li>
</ol>
<h2 id="go-命令-和-bootm-命令"><a href="#go-命令-和-bootm-命令" class="headerlink" title="go 命令 和 bootm 命令"></a>go 命令 和 bootm 命令</h2><img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/Go_command.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />

<img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/bootm_command.png" srcset="/img/loading.gif" lazyload style="zoom:80%;" />



<h2 id="Kconfig-和-Makefile"><a href="#Kconfig-和-Makefile" class="headerlink" title="Kconfig 和 Makefile"></a>Kconfig 和 Makefile</h2><h3 id="几个思考题："><a href="#几个思考题：" class="headerlink" title="几个思考题："></a>几个思考题：</h3><figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">思考:Makefile里面指定的文件是否参与编译，收谁的影响呢？<br>回答:.config里面配置宏会产生影响<br><br>思考:.config是如何生成的呢？<br>回答:make ARCH=arm menuconfig进行配置的时候生成<br><br>思考:menuconfig时候，菜单的信息来源于哪里呢？<br>回答:由Kconfig文件提供菜单信息<br></code></pre></div></td></tr></table></figure>



<p><img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/Linux_Kernel_Compile.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="Kconfig-和-Makefile-1"><a href="#Kconfig-和-Makefile-1" class="headerlink" title="Kconfig 和 Makefile"></a>Kconfig 和 Makefile</h3><ol>
<li><p><strong>Makefile : 完成对文件或目录编译</strong></p>
<blockquote>
<p>基本语法：</p>
<ol>
<li><p>写死</p>
<figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile">obj-y += dir/ 或 obj-y += file.o<br></code></pre></div></td></tr></table></figure>

<p>表示对应目录需要编译进内核或指定的文件需要编译进内核</p>
</li>
<li><p>根据宏指定</p>
<figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile">obj-<span class="hljs-variable">$(CONFIG_XXX)</span> += dir/ 或 obj-<span class="hljs-variable">$(CONFIG_XXX)</span> += file.o<br></code></pre></div></td></tr></table></figure>

<p>表示对应目录或文件是否需要编译进内核，取决于CONFIG_XXX宏的定义,也就是在 .config 中是否有这个</p>
<p>宏的定义:<br>CONFIG_XXX=y</p>
</li>
<li><p>问题:</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">问题:.config 是什么文件呢?<br>回答:内核的配置文件<br></code></pre></div></td></tr></table></figure></li>
</ol>
</blockquote>
</li>
<li><p><strong>Kconfig : 提供内核的配置菜单选项</strong></p>
<blockquote>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">问:Linux源码中的文件是如何编译进内核的?<br>答:(1)make menuconfig<br>   Kconfig为它提供菜单信息配置完以后，会将配置信息写入.config (例如:CONFIG<span class="hljs-emphasis">_XXXX=y)</span><br><span class="hljs-emphasis"></span><br><span class="hljs-emphasis">(2).config文件会被Makefile使用，Makefile将会根据.config</span><br><span class="hljs-emphasis">   文件中CONFIG_</span>XXX来决定对应的文件是否需要编译进内核 <br></code></pre></div></td></tr></table></figure></blockquote>
</li>
<li><p>Makefile 和 Kconfig 都是通过分级管理代码编译</p>
</li>
<li><p>Makefile 是相对路径，Kconfig 是绝对路径</p>
</li>
</ol>
<h3 id="Kconfig-语法"><a href="#Kconfig-语法" class="headerlink" title="Kconfig 语法"></a>Kconfig 语法</h3><figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile"><span class="hljs-comment"># 配置选项</span><br>config 选项名<br>	属性1<br>	属性2<br>	...<br></code></pre></div></td></tr></table></figure>

<ol>
<li><p>选项名</p>
<blockquote>
<ul>
<li><code>config HELLO</code></li>
</ul>
<p>展现的形式:<code>CONFIG_HELLO</code>,在<code>.config</code>文件中定义 </p>
</blockquote>
</li>
<li><p>属性</p>
<blockquote>
<ol>
<li><p>选择类型</p>
<blockquote>
<figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile">&lt;1&gt; tristate(三态)   y:编译进内核  m:编译成模块  n:不编译   &lt; &gt;<br>&lt;2&gt; bool             y:编译进内核  n:不编译   [ ]<br>&lt;3&gt; string     CONFIG_选项名=<span class="hljs-string">&quot;字符串&quot;</span>     ()<br>&lt;4&gt; int        CONFIG_选项名=整数 <br>&lt;5&gt; hex        CONFIG_选项名=十六进制数<br></code></pre></div></td></tr></table></figure></blockquote>
</li>
<li><p>提示字符串</p>
<p><code>prompt</code> “提示字符串” (配置菜单中显示)</p>
</li>
<li><p>range 指定值的范围</p>
</li>
<li><p>help  帮助信息</p>
<figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile">help <br>	<span class="hljs-string">&quot;test help ...&quot;</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>default 默认设置</p>
<figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile">config HELLO <br>		tristate <br>		prompt <span class="hljs-string">&quot;hello support&quot;</span><br>		default y<br></code></pre></div></td></tr></table></figure></li>
<li><p>depends on 配置选项名</p>
<figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile">[1]depends on 配置选项名 <br>[2]depends on 配置选项名1(m) || 配置选项名2(y) <br>[3]depends on 配置选项名1(y) &amp;&amp; 配置选项名3(m)<br><br><span class="hljs-section">y:2  m:1  n:0</span><br>&amp;&amp; -&gt; 最小值<br>|| -&gt; 最大值<br><br><span class="hljs-section">注意:如果依赖的结果为0:不可见,  2:三态 , 1:两态</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>select 配置选项名 </p>
<p>当前配置选项被选中的时候，同时选择select 指定的配置型选项</p>
</li>
<li><p>source 路径/Kconfig</p>
<p>将这个路径下的Kconfig文件包含进来 </p>
</li>
</ol>
</blockquote>
<p><strong>注意：1. 选择类型 2. 提示字符串 必须有，其他的是可选项</strong></p>
</li>
</ol>
<h2 id="如何在Linux-内核中添加自己的代码"><a href="#如何在Linux-内核中添加自己的代码" class="headerlink" title="如何在Linux 内核中添加自己的代码"></a>如何在Linux 内核中添加自己的代码</h2><ol>
<li><p>把自己的代码拷贝到内核源码树下</p>
</li>
<li><p>编写一个自己的Makefile和 Kconfig  (如果目录下已经有Makefile和Kconfig文件，则直接修改他们)</p>
<figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile"><span class="hljs-comment"># Makefile:</span><br>obj-<span class="hljs-variable">$(CONFIG_XXX)</span> += file.o<br></code></pre></div></td></tr></table></figure>

<figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile"><span class="hljs-comment"># Kconfig:</span><br>config XXX<br> 	tristate <span class="hljs-string">&quot;.....&quot;</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>在它的上一层目录下，修改Makefile和Kconfig (可选)</p>
<p><strong>注意 : 如果是直接修改 Makefile 和 Kconfig，则不需要第三步</strong> </p>
</li>
<li><p>make menuconfig  </p>
<p>选中我们的配置选项</p>
</li>
<li><p>重新编译内核         </p>
</li>
</ol>
<h1 id="制作设备树文件"><a href="#制作设备树文件" class="headerlink" title="制作设备树文件"></a>制作设备树文件</h1><ol>
<li><p>进入 <code>arch/arm/boot/dts/</code> 目录</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">cp exynos4412-origen.dts exynos4412-fs4412.dts<br></code></pre></div></td></tr></table></figure></li>
<li><p>修改 添加要编译的设备树文件 ，在Makefile中 （在arch/arm/boot/dts/ 下的Makefile）</p>
<figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile"><span class="hljs-comment"># 在exynos4412-origen.dtb \ 后添加</span><br>exynos4412-fs4412.dtb \<br></code></pre></div></td></tr></table></figure></li>
<li><p>修改 <code>exynos4412-fs4412.dts</code> 添加：</p>
<figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile">srom-cs1@5000000 &#123;<br>	compatible = <span class="hljs-string">&quot;simple-bus&quot;</span>;<br>	<span class="hljs-comment">#address-cells = &lt;1&gt;;</span><br>	<span class="hljs-comment">#size-cells = &lt;1&gt;;</span><br>	reg = &lt;0x5000000 0x1000000&gt;;<br>	ranges;<br>	ethernet@5000000 &#123;<br>		compatible = <span class="hljs-string">&quot;davicom,dm9000&quot;</span>;<br>		reg = &lt;0x5000000 0x2 0x5000004 0x2&gt;;<br>		interrupt-parent = &lt;&amp;gpx0&gt;;<br>		interrupts = &lt;6 4&gt;;<br>		davicom,no-eeprom;<br>		mac-address = [00 0a 2d a6 55 a2];<br>	&#125;;<br>&#125;;<br></code></pre></div></td></tr></table></figure></li>
<li><p>重新编译 设备树文件</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">make ARCH=arm  CROSS_COMPILE=arm-none-linux-gnueabi- dtbs<br><span class="hljs-comment"># 在Linux Kernel 顶级目录下执行</span><br></code></pre></div></td></tr></table></figure></li>
</ol>
<h1 id="制作文件系统"><a href="#制作文件系统" class="headerlink" title="制作文件系统"></a>制作文件系统</h1><h2 id="Linux-解压后的启动流程"><a href="#Linux-解压后的启动流程" class="headerlink" title="Linux 解压后的启动流程"></a>Linux 解压后的启动流程</h2><blockquote>
<ol>
<li>启动 bootloader</li>
<li>建立映射表，使能 MMU</li>
<li>清除 bss段，设置sp</li>
<li>跳转到C语言部分执行，启动内核</li>
</ol>
</blockquote>
<img src="https://cdn.jsdelivr.net/gh/Zoom-EobardThawne/MyPicGo/img/Linux_Boot_Process.png" srcset="/img/loading.gif" lazyload style="zoom: 67%;" />



<h2 id="u-boot-的参数传递"><a href="#u-boot-的参数传递" class="headerlink" title="u_boot 的参数传递"></a>u_boot 的参数传递</h2><h3 id="u-boot-和-Linux-内核之间的参数传递"><a href="#u-boot-和-Linux-内核之间的参数传递" class="headerlink" title="u_boot 和 Linux 内核之间的参数传递"></a>u_boot 和 Linux 内核之间的参数传递</h3><blockquote>
<ol>
<li>r0 : 0</li>
<li>r1 : 开发板ID</li>
<li>r2 : 其他参数在内存中的开始地址</li>
</ol>
</blockquote>
<p>r1 的参数，让Linux内核自己去判断，它是否支持当前的开发板</p>
<p>r2 的参数，是其他参数在内存中的开始地址</p>
<h3 id="r2所保存的地址中，存放哪些信息"><a href="#r2所保存的地址中，存放哪些信息" class="headerlink" title="r2所保存的地址中，存放哪些信息?"></a>r2所保存的地址中，存放哪些信息?</h3><blockquote>
<ol>
<li><p><strong>内存的信息</strong><br>内存的开始地址和内存的大小</p>
</li>
<li><p><strong>命令行参数:bootargs的内容</strong><br>告诉Linux内核启动后，挂载文件系统的方式(例如:NFS方式)</p>
</li>
<li><p><strong>其他信息</strong></p>
</li>
</ol>
</blockquote>
<h3 id="Linux内核怎么知道访问的参数在哪结束？"><a href="#Linux内核怎么知道访问的参数在哪结束？" class="headerlink" title="Linux内核怎么知道访问的参数在哪结束？"></a>Linux内核怎么知道访问的参数在哪结束？</h3><blockquote>
<p>问：u_boot引导Linux内核启动的时候，需要传递一些参数告诉Linux内核当前环境, 但是在传递参数的时候，只是告诉了参数所在内存的开始地址，并没有告诉Linux内核，可以访问的内存的大小,Linux内核它是如何知道它访问的参数结束的地方在那里?</p>
<p>答：u_boot和Linux之间在传递参数的时候，是按照双方约定的格式传递的</p>
</blockquote>
<h3 id="目前Linux内核支持哪些格式的传递呢"><a href="#目前Linux内核支持哪些格式的传递呢" class="headerlink" title="目前Linux内核支持哪些格式的传递呢?"></a>目前Linux内核支持哪些格式的传递呢?</h3><blockquote>
<ol>
<li><p>通过struct parm_struct结构体来传递 (Linux 2.6之前使用的方式,已经过时，不便于扩展)</p>
</li>
<li><p>通过tag列表来传递 (Linux 2.6开始使用的方式)</p>
<blockquote>
<p>一个tag节点 : tag头 + 大小 + 内容</p>
</blockquote>
</li>
<li><p>通过设备树来传递(Linux 3.0开始使用的方式)</p>
<blockquote>
<ol>
<li>u_boot 修改了设备树的节点(bootargs参数节点和内存信息节点)，把需要传递的信息放在设备树中。</li>
<li>在r2寄存器中记录了设备树在内存中的地址。</li>
</ol>
</blockquote>
</li>
</ol>
<p>注意:</p>
<ol>
<li>在Linux 3.0之后的内核，这些方式都支持。        </li>
<li>可以参看u-boot-2013-learn/arch/arm/lib/bootm.c文件了解参数传递过程</li>
</ol>
</blockquote>
<h2 id="系统启动时如何自动执行自己的程序"><a href="#系统启动时如何自动执行自己的程序" class="headerlink" title="系统启动时如何自动执行自己的程序"></a>系统启动时如何自动执行自己的程序</h2><ol>
<li><p>在bootargs参数中指定自己的程序</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">init=/linuxrc 默认的写法<br>init=我们自己程序的路径<br><span class="hljs-code">	 </span><br><span class="hljs-code">例如:</span><br><span class="hljs-code">我们需要执行的程序是hello,它的路径是在/test/hello</span><br><span class="hljs-code">	 </span><br><span class="hljs-code">init=/test/hello</span><br><span class="hljs-code">     </span><br><span class="hljs-code">缺点:</span><br><span class="hljs-code">没有启动init进程</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>在/etc/inittab文件中，添加自己的程序</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">默认启动的是init进程，init进程启动的过程中，读取/etc/inittab文件，并且将这个文件指定的程序启动起来。所以我们可以在这个文件中添加自己程序。<br><span class="hljs-code">	 </span><br><span class="hljs-code">例如:</span><br><span class="hljs-code">我们需要执行的程序是hello,它的路径是在/test/hello,并且我们这个程序不能被杀死</span><br><span class="hljs-code">	 </span><br><span class="hljs-code">::respawn:/test/hello</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>在/etc/init.d/rcS的脚本 ，添加自己的程序</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">init进程启动的时候，会执行/etc/init.d/rcS的脚本，我们可以在这个脚本中添加自己的程序。<br>例如:<br>/<span class="hljs-built_in">test</span>/hello 或 /<span class="hljs-built_in">test</span>/hello &amp; (后台运行)<br></code></pre></div></td></tr></table></figure></li>
<li><p>在/etc/profile文件中，添加自己的程序</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">init进程启动的时候，会执行/bin/sh,是一个shell程序，shell程序执行的时候，会执行/etc/profile文件,这是一个脚本文件，所以我们在脚本中添加自己的程序。<br><span class="hljs-code">	</span><br><span class="hljs-code">例如:</span><br><span class="hljs-code">/test/hello 或 /test/hello &amp; (后台运行)</span><br></code></pre></div></td></tr></table></figure></li>
</ol>
<p>注意：</p>
<blockquote>
<p>很多时候我们会选择在 2 或 4 中添加</p>
<p>2 可以让自己的进程死掉后，重新启动</p>
<p>4 可以让自己的程序在执行的时候，执行的环境比较好</p>
</blockquote>
<h2 id="制作根文件系统-—-以-busybox-为例"><a href="#制作根文件系统-—-以-busybox-为例" class="headerlink" title="制作根文件系统 — 以 busybox 为例"></a>制作根文件系统 — 以 busybox 为例</h2><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><ol>
<li><p>编译 busybox</p>
<blockquote>
<ol>
<li><p>下载源码：<a target="_blank" rel="noopener" href="http://busybox.net/downloads/">busybox-1.22.1.tar.bz2</a></p>
</li>
<li><p>解压源码:     <code>tar -xvf busybox-1.22.1.tar.bz2</code></p>
</li>
<li><p>进入源码目录 <code>cd busybox-1.22.1</code></p>
</li>
<li><p>配置源码：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ make menuconfig<br>Busybox Settings ---&gt;<br>	Build Options ---&gt;<br>		[*] Build BusyBox as a static binary (no shared libs)<br>		[ ] Force NOMMU build<br>		[ ] Build with Large File Support (<span class="hljs-keyword">for</span> accessing files &gt; 2 GB)<br>		(arm-none-linux-gnueabi-) Cross Compiler prefix<br>		() Additional CFLAGS<br></code></pre></div></td></tr></table></figure></li>
</ol>
</blockquote>
</li>
<li><p>安装   <code>make install</code></p>
</li>
<li><p>创建需要的其他目录   </p>
<blockquote>
<ol>
<li><p>安装完成后进入 <code>_install</code> 目录</p>
</li>
<li><p>创建其他需要的目录</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">mkdir dev etc mnt proc var tmp sys root<br></code></pre></div></td></tr></table></figure></li>
</ol>
</blockquote>
</li>
<li><p>添加库文件</p>
<blockquote>
<ol>
<li><p>寻找编译器路径 : </p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">which</span> arm-none-linux-gnueabi-gcc<br>   <br><span class="hljs-comment"># /home/linux/03.fs4412/toolchain/gcc-4.6.4/bin/arm-none-linux-gnueabi-gcc</span><br></code></pre></div></td></tr></table></figure>

<p>进入 该路径下的 bin 目录发现都是编译器的文件</p>
<p>我们再退到上一级目录，即 <code> /home/linux/03.fs4412/toolchain/gcc-4.6.4/</code> 下搜寻</p>
</li>
<li><p>搜寻 共享库文件</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">find -name *.so<br></code></pre></div></td></tr></table></figure>

<p>注意我们要的是系统的动态库文件, 最后的路径是:</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">/home/linux/03.fs4412/toolchain/gcc-4.6.4/arm-arm1176jzfssf-linux-gnueabi/sysroot/lib<br></code></pre></div></td></tr></table></figure></li>
<li><p>将 <strong>lib 目录</strong> 拷贝到 _install 目录下 <strong>注意：</strong>拷贝整个目录 结尾加 <code>-a</code> 参数</p>
</li>
<li><p>删除静态库 和 共享库文件中的符号表 — 确保 lib 目录大小不超过 8M</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> _install/lib<br><span class="hljs-comment"># 删除静态库</span><br>sudo rm -rf *.a<br><span class="hljs-comment"># 删除所有的符号表</span><br>arm-none-linux-guneabi-strip *<br><span class="hljs-comment"># strip 命令 : 从特定文件中剥掉一些符号信息和调试信息，使文件变小。</span><br>   <br><span class="hljs-comment"># 这里会出现权限不够，或者是找不到命令的错误，如果出现上述错误则 : </span><br><span class="hljs-built_in">which</span> arm-none-linux-guneabi-strip<br><span class="hljs-comment"># 复制路径 如:</span><br><span class="hljs-comment"># /home/linux/03.fs4412/toolchain/gcc-4.6.4/bin/arm-none-linux-gnueabi-strip</span><br><span class="hljs-comment"># sudo 刚刚复制的路径 *</span><br>sudo /home/linux/03.fs4412/toolchain/gcc-4.6.4/bin/arm-none-linux-gnueabi-strip *<br></code></pre></div></td></tr></table></figure></li>
</ol>
</blockquote>
</li>
</ol>
<h3 id="用到的一些-Linux-命令"><a href="#用到的一些-Linux-命令" class="headerlink" title="用到的一些 Linux 命令"></a>用到的一些 Linux 命令</h3><ul>
<li><code>which xxx</code> ：定位文件的路径</li>
<li><code>find -name xxx</code> ：按名字搜索文件</li>
<li><code>nm libc-2.17.so | grep printf</code> : 搜寻 c  库中，printf 的符号</li>
<li><code>du -mh xxx</code> ：显示xxx 文件的大小</li>
</ul>
<h3 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h3><ol>
<li><p>在 etc 下添加文件 inittab，文件内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment">#this is run first except when booting in single-user mode.</span><br>::sysinit:/etc/init.d/rcS<br><span class="hljs-comment"># /bin/sh invocations on selected ttys</span><br><span class="hljs-comment"># start an &quot;askfirst&quot; shell on the console (whatever that may be)</span><br>::askfirst:-/bin/sh<br><span class="hljs-comment"># stuff to do when restarting the init process</span><br>::restart:/sbin/init<br><span class="hljs-comment"># stuff to do before rebooting</span><br>::ctrlaltdel:/sbin/reboot<br></code></pre></div></td></tr></table></figure></li>
<li><p>在 etc 下添加文件 fstab，文件内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-comment">#device mount-point type options dump fsck order</span><br>proc /proc proc defaults 0 0<br>tmpfs /tmp tmpfs defaults 0 0<br>sysfs /sys sysfs defaults 0 0<br>tmpfs /dev tmpfs defaults 0 0<br></code></pre></div></td></tr></table></figure></li>
<li><p>在 etc 下创建 init.d 目录，并在 init.d 下创建 rcS 文件，rcS 文件内容为：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment"># This is the first script called by init process</span><br>/bin/mount -a<br><span class="hljs-built_in">echo</span> /sbin/mdev &gt; /proc/sys/kernel/hotplug<br>/sbin/mdev -s<br></code></pre></div></td></tr></table></figure>

<p>为 rcS 添加可执行权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">chmod +x init.d/rcS<br><span class="hljs-comment"># 或者</span><br>chmod 777 init.d/rcS<br></code></pre></div></td></tr></table></figure></li>
<li><p>在 etc 下添加 profile 文件，文件内容为：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-built_in">export</span> HOSTNAME=farsight<br><span class="hljs-built_in">export</span> USER=root<br><span class="hljs-built_in">export</span> HOME=root<br><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&quot;[<span class="hljs-variable">$USER</span>@<span class="hljs-variable">$HOSTNAME</span> \W]\# &quot;</span><br>PATH=/bin:/sbin:/usr/bin:/usr/sbin<br>LD_LIBRARY_PATH=/lib:/usr/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> PATH LD_LIBRARY_PATH<br></code></pre></div></td></tr></table></figure></li>
</ol>
<h3 id="制作-ramdisk-文件系统"><a href="#制作-ramdisk-文件系统" class="headerlink" title="制作 ramdisk 文件系统"></a>制作 ramdisk 文件系统</h3><ol>
<li><p>制作一个大小为 8M 的镜像文件</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ <span class="hljs-built_in">cd</span> ~<br>$ dd <span class="hljs-keyword">if</span>=/dev/zero of=ramdisk bs=1k count=8192 （ramdisk 为 8M）<br></code></pre></div></td></tr></table></figure></li>
<li><p>格式化这个镜像文件为 ext2</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ mkfs.ext2 -F ramdisk<br></code></pre></div></td></tr></table></figure></li>
<li><p>创建 initrd 目录作为挂载点</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ sudo mkdir initrd<br></code></pre></div></td></tr></table></figure></li>
<li><p>将这个磁盘镜像文件挂载 initrd/ 下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ sudo mount -t ext2 ramdisk ./initrd<br></code></pre></div></td></tr></table></figure></li>
<li><p> 将我们的文件系统复制到 ramdisk 中</p>
</li>
</ol>
   <figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">sudo cp /<span class="hljs-built_in">source</span>/rootfs/* ./initrd –a<br></code></pre></div></td></tr></table></figure>

<ol start="6">
<li><p>卸载 initrd</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ sudo umount ./initrd<br></code></pre></div></td></tr></table></figure></li>
<li><p>压缩 ramdisk 为 ramdisk.gz </p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ gzip --best -c ramdisk &gt; ramdisk.gz<br></code></pre></div></td></tr></table></figure></li>
<li><p>格式化为 uboot 识别的格式 复制到 tftpboot</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">$ mkimage -n <span class="hljs-string">&quot;ramdisk&quot;</span> -A arm -O linux -T ramdisk -C gzip -d ramdisk.gz ramdisk.img<br><br>$ cp ramdisk.img /tftpboot<br></code></pre></div></td></tr></table></figure></li>
<li><p>在 U-BOOT 命令行重新设置启动参数 <code>bootcmd</code></p>
</li>
<li><p><strong>配置内核支持RAMDISK （重要）</strong></p>
<figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile">make menuconfig<br>File systems ---&gt;<br>	&lt;*&gt; Second extended fs support<br>Device Drivers<br>	SCSI device support ---&gt;<br>		&lt;*&gt; SCSI disk support<br>	Block devices ---&gt;<br>		&lt;*&gt;RAM block device support<br>		(16)Default number of RAM disks<br>		(8192) Default RAM disk size (kbytes) (修改为 8M)<br>General setup ---&gt;<br>	[*] Initial RAM filesystem and RAM disk (initramfs/initrd) support<br></code></pre></div></td></tr></table></figure>

<p>重新编译内核，复制到 /tftpboot</p>
</li>
</ol>
<h1 id="制作u-boot"><a href="#制作u-boot" class="headerlink" title="制作u_boot"></a>制作u_boot</h1><h2 id="前期准备"><a href="#前期准备" class="headerlink" title="前期准备"></a>前期准备</h2><h3 id="开发平台"><a href="#开发平台" class="headerlink" title="开发平台"></a>开发平台</h3><ol>
<li><p>CPU核：</p>
<p>ARM cortex-A9     armv7指令集</p>
</li>
<li><p>SOC：</p>
<p>Samsung     exynos4412    4个cortex-A9核</p>
</li>
<li><p>board：</p>
<p>fs4412 —–&gt; 参照三星的母板进行设计</p>
</li>
</ol>
<h3 id="u-boot-的目录结构"><a href="#u-boot-的目录结构" class="headerlink" title="u_boot 的目录结构"></a>u_boot 的目录结构</h3><table>
<thead>
<tr>
<th align="left">Directory</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">board/</td>
<td align="left">存放是特定开发板相关的代码,一般以芯片厂家的名字命名</td>
</tr>
<tr>
<td align="left">arch/</td>
<td align="left">跟CPU架构相关的代码</td>
</tr>
<tr>
<td align="left">include/</td>
<td align="left">存放的是uboot相关代码需要头文件</td>
</tr>
<tr>
<td align="left">net/</td>
<td align="left">uboot支持的一些网络协议</td>
</tr>
<tr>
<td align="left">lib/</td>
<td align="left">多有平台通用的代码</td>
</tr>
<tr>
<td align="left">common/</td>
<td align="left">uboot支持的命令实现代码</td>
</tr>
<tr>
<td align="left">driver/</td>
<td align="left">uboot支持的一些硬件驱动代码</td>
</tr>
<tr>
<td align="left">boards.cfg</td>
<td align="left">u-boot 支持的板子的配置信息</td>
</tr>
</tbody></table>
<h3 id="通过-tags-文件阅读源码"><a href="#通过-tags-文件阅读源码" class="headerlink" title="通过 tags 文件阅读源码"></a>通过 tags 文件阅读源码</h3><ol>
<li><p>tags 文件是通过命令:  ctags -R  生成索引文件</p>
<p>源代码目录下所有的<strong>结构体定义，函数的定义，宏定义</strong>都可以通过索引文件找到它所在的路径文件</p>
</li>
<li><p>使用方法： </p>
<p>ctrl + ]  跳转到指定符号所定义的文件<br>ctrl + t  返回 </p>
</li>
<li><p>路径配置</p>
<p><strong>必须让vi编辑器能寻找到tags文件</strong> </p>
<p>vi 默认在当前目录下寻找 tags 文件，需要添加路径方可在任意路径访问</p>
<p>修改用户主目录下的.vimrc文件,添加自己tags文件路径，这样vi编辑器就可以找到我们的tags啦</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash"><span class="hljs-built_in">set</span> tags+=/home/linux/03.fs4412/bootloader/u-boot-2013-learn/tags<br></code></pre></div></td></tr></table></figure>

</li>
<li><p>通过grep/find命令搜索我们的符号所定义的地方 </p>
<p>在源码的顶层目录执行如下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">grep <span class="hljs-string">&quot;符号名&quot;</span>  * -n -R<br>find -name 文件名<br></code></pre></div></td></tr></table></figure></li>
</ol>
<h2 id="u-boot-启动流程-（重点）"><a href="#u-boot-启动流程-（重点）" class="headerlink" title="u-boot 启动流程 （重点）"></a>u-boot 启动流程 （重点）</h2><p>案例：fs4412开发板</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">硬件信息<br>SOC        : 三星 exynos4412 (4个cortex-A9 ARM核)  主频 1.4GHZ<br>board      : origen&lt;-&gt;fs4412 <br>u-boot版本 : u-boot-2013.01<br></code></pre></div></td></tr></table></figure>

<h3 id="1-fs4412启动"><a href="#1-fs4412启动" class="headerlink" title="1. fs4412启动"></a>1. fs4412启动</h3><blockquote>
<ol>
<li><p>exyxnos4412 内部固化的irom代码先运行</p>
<blockquote>
<ol>
<li>确定启动的设备</li>
<li>初始化启动的设备</li>
<li>将其懂设备一开始的一部分代码 （BL1）搬移到 exynos4412 内部的 iram（SRAM）运行</li>
</ol>
</blockquote>
<p>注意：BL1 代码是三星提供的，irom的代码在读取BL1的时候，会对它做验证，如果验证通过则运行它。</p>
</li>
<li><p>在iram 运行BL1代码 </p>
<blockquote>
<ol>
<li>确定启动设备</li>
<li>将启动设备中的 BL2 代码拷贝到 exynos4412 内部的 iram 运行</li>
</ol>
</blockquote>
<p>注意：BL2指的的是u_boot的第一阶段代码</p>
</li>
</ol>
</blockquote>
<h3 id="2-u-boot-代码开始运行"><a href="#2-u-boot-代码开始运行" class="headerlink" title="2. u-boot 代码开始运行"></a>2. u-boot 代码开始运行</h3><ol>
<li><p>**u-boot 第一阶段 (BL2 代码)**：</p>
<blockquote>
<ol>
<li>设置ARM核为SVC模式</li>
<li>设置异常向量表，告诉ARM核异常向量表基地址</li>
<li>关闭Cache和MMU</li>
<li>初始化系统时钟</li>
<li>初始化内存</li>
<li>将u_boot(第二阶段)从存储介质中搬移到内存中（board_init_f）</li>
</ol>
</blockquote>
</li>
<li><p>**u-boot 第二阶段 (BL3 代码)**：</p>
<blockquote>
<ol>
<li><p>设置ARM核为SVC模式</p>
</li>
<li><p>设置异常向量表，告诉ARM核异常向量表基地址</p>
</li>
<li><p>关闭Cache和MMU</p>
</li>
<li><p>….（<strong>此时u_boot已经运行在内存，不需要初始化系统时钟和内存</strong>）</p>
</li>
</ol>
<ol start="5">
<li><p>_main</p>
<blockquote>
<ol>
<li>设置 sp</li>
<li>调用了 board_init_f</li>
</ol>
</blockquote>
</li>
<li><p>board_init_f (板子第一阶段初始化)</p>
<blockquote>
<ol>
<li><p>完成基本的初始化</p>
<blockquote>
<ul>
<li>SOC ID的获取</li>
<li>定时器初始化</li>
<li>串口的初始化</li>
<li>从串口中输出了一些信息</li>
</ul>
</blockquote>
</li>
<li><p>为 u_boot 重定向做准备</p>
<blockquote>
<p>在内存最顶端划分空间</p>
</blockquote>
</li>
</ol>
</blockquote>
</li>
<li><p>重定向 u_boot </p>
<blockquote>
<p>如果 u_boot 不是在顶端内存，则将 u_boot 从底端内存搬移到顶端内存</p>
</blockquote>
</li>
<li><p>清除 BSS 段</p>
<blockquote>
<p>为运行C语言程序做准备</p>
</blockquote>
</li>
<li><p>board_init_r (板子第二阶段初始化)</p>
<blockquote>
<ol>
<li><p>初始化硬件设备</p>
<blockquote>
<ul>
<li>EMMC存储器</li>
<li>DM9000网卡设备</li>
<li>…….</li>
</ul>
</blockquote>
</li>
<li><p>从存储介质中读取了环境变量的值</p>
</li>
</ol>
</blockquote>
</li>
<li><p>main_loop</p>
<blockquote>
<ul>
<li>获取了bootdelay和bootcmd环境变量的值，如果没有设置bootcmd则进入u_boot交互界面。</li>
<li>如果设置了bootcmd,判断在到计时时间内，如果用户没有打断，则执行bootcmd命令。</li>
<li>如果倒计时时间内，被用户打断，则进入u_boot交互界面。</li>
</ul>
</blockquote>
<p>注意：u_boot交互界面，循环读取用户输入的命令，然后执行。</p>
</li>
</ol>
</blockquote>
</li>
</ol>
<h2 id="u-boot-移植-（重点）"><a href="#u-boot-移植-（重点）" class="headerlink" title="u-boot 移植 （重点）"></a>u-boot 移植 （重点）</h2><h3 id="u-boot-移植的核心思想"><a href="#u-boot-移植的核心思想" class="headerlink" title="u-boot 移植的核心思想"></a>u-boot 移植的核心思想</h3><ol>
<li>厂家直接提供u-boot -&gt; 烧写 或者 修改(增加新功能) 或 u-boot 版本升级</li>
<li>芯片公司,让u-boot支持公司的芯片 ,自己仿照别的厂家，添加自己开发板相关代码</li>
<li>芯片公司根据自己的芯片编写bootloader,仿照u-boot设计思想</li>
</ol>
<p><strong>需要掌握的核心知识点：</strong></p>
<ol>
<li><p>熟悉SOC芯片和u-boot启动流程</p>
</li>
<li><p>系统时钟，内存是否能正常初始化</p>
</li>
<li><p>搬移u-boot到内存过程 (从存储介质中读取数据，然后写到内存)</p>
</li>
<li><p>对存储介质(emmc)如何进行读写</p>
</li>
</ol>
<h3 id="u-boot-移植"><a href="#u-boot-移植" class="headerlink" title="u-boot 移植"></a>u-boot 移植</h3><p>在u-boot 源码中找到和自己开发板类似的板子，基于该开发板做移植</p>
<ol>
<li><p>芯片厂家 &amp;&amp; 芯片型号</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">samsung   exynos4412    ===&gt; 三星母板 : smdk4412 (orgien)<br><br>在u-boot中没有找到  母板(芯片厂家做出一款芯片后，设计的第一块开发板)	<br>&lt;1&gt;查阅一下芯片厂家给予这个芯片是否做了其他母板<br>&lt;2&gt;是不是当前u-boot版本中，芯片厂家还没有将自己的母板代码添加进来 ----&gt; 去新版本的u-boot中寻找	<br></code></pre></div></td></tr></table></figure></li>
<li><p>在<code> boards.cfg</code> 文件中选择和自己开发板相近的参考板进行编译</p>
<blockquote>
<ol>
<li><p>针对自己的开发板配置u-boot : make 开发板名_config</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 例如(fs4412 &lt;-----&gt; origen):</span><br>make origen_config    ----------&gt; include/config.mk <br></code></pre></div></td></tr></table></figure></li>
<li><p>编译 </p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">make CROSS_COMPILE=arm-none-linux-gnueabi-<br><span class="hljs-meta">#</span><span class="bash"> 生成u-boot.bin适用于origen ,移植的思想：修改origen的开发板的uboot代码</span> <br></code></pre></div></td></tr></table></figure></li>
</ol>
</blockquote>
</li>
<li><p>将 <code>u-boot.bin</code> 下载到内存运行</p>
<blockquote>
<p>下载的地址 : 编译u_boot的时候指定的代码运行地址(CONFIG_SYS_TEXT_BASE)</p>
</blockquote>
</li>
<li><p>运行内存中的 <code>u-boot.bin</code> </p>
<blockquote>
<p><code>go</code>   u_boot所在内存的地址</p>
</blockquote>
</li>
<li><p>如果通过 <code>go</code> 命令启动 u-boot 的时候，没有任何输出效果？</p>
<blockquote>
<ol>
<li>u-boot在内存中运行的时候，重新初始化了系统时钟和内存?</li>
<li>没有初始化串口?</li>
<li>指定内存基地址不对? </li>
<li>? (点灯大法:通过在一些位置加亮灯代码,确定导致u-boot死掉的代码) </li>
<li>TrustZone代码有问题?</li>
</ol>
</blockquote>
<p>注意：</p>
<figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">在u-boot-2013.01 for fs4412上面，是由于TruszZone的代码有问题，我们只需要将 <br>board/samsung/origen/lowlevel<span class="hljs-emphasis">_init.S</span><br><span class="hljs-emphasis">文件中的bl tzpc_</span>init代码注释掉就可以了<br></code></pre></div></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">- &quot;u-boot.bin&quot;   is a raw binary image （bootloader第二阶段代码）<br>- &quot;u-boot&quot; 		 is an image in ELF binary format<br>- &quot;u-boot.srec&quot;  is in Motorola S-Record format<br>- &quot;u-boot.map&quot;   记录了生成u-boot代码所需要文件的路径 <br>- &quot;System.map&quot;   记录了u-boot中标签名和函数名对应的地址 <br></code></pre></div></td></tr></table></figure></li>
</ol>
<h2 id="DM9000-网卡移植"><a href="#DM9000-网卡移植" class="headerlink" title="DM9000 网卡移植"></a>DM9000 网卡移植</h2><h3 id="通信方式-："><a href="#通信方式-：" class="headerlink" title="通信方式 ："></a>通信方式 ：</h3><blockquote>
<p>There are only two addressing ports through the access of the host interface. One port is the INDEX port and the other is the DATA port. The INDEX port is decoded by the pin CMD =0 and the DATA port by the pin CMD =1. </p>
<p>The contents of the INDEX port are the register address of the DATA port. Before the access of any register, the address of the register must be saved in the INDEX port. </p>
</blockquote>
<p>主要通过别人已经实现的代码，去了解DM9000的使用方法，根据自己的需求进行修改</p>
<h2 id="对于驱动一个硬件设备的时候，需要做的事情"><a href="#对于驱动一个硬件设备的时候，需要做的事情" class="headerlink" title="对于驱动一个硬件设备的时候，需要做的事情"></a>对于驱动一个硬件设备的时候，需要做的事情</h2><ol>
<li><p>了解硬件设备的背景知识 (网上查资料或datasheet) </p>
<p>硬件功能，特性，参数,硬件工作原理</p>
</li>
<li><p>阅读硬件原理图 : 硬件接到了那些CPU管脚</p>
</li>
<li><p>从SOC芯片手册中，找到控制管脚的GPIO控制器(需要初始化GPIO管脚)</p>
</li>
<li><p>从SOC芯片手册中，找到控制设备的控制器(需要初始化控制器)</p>
</li>
<li><p>有些设备对他进行控制的时候，是通过操作它内部的寄存器完成控制</p>
<p>此时，我们阅读datasheet，查看如何操作芯片内部的寄存器</p>
</li>
</ol>
<p>一些工程小方法</p>
<ol>
<li><p>编写脚本执行编译命令</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">make CROSS_COMPILE=arm-none-linux-guneabi-<br><span class="hljs-meta">#</span><span class="bash"> 编译u-boot</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>屏蔽非报错信息</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">make CROSS_COMPILE=arm-none-linux-guneabi- 1&gt;/dev/null<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 将标准输出信息重定向到 /dev/null 目录下，就是丢弃标准输出信息，只输出错误信息</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>学会 “抄”别人的实现代码</p>
</li>
</ol>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ARM/">ARM</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/ARM/">ARM</a>
                    
                      <a class="hover-with-bg" href="/tags/Linux/">Linux</a>
                    
                      <a class="hover-with-bg" href="/tags/%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/">系统移植</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/Qt-Note/">
                        <span class="hidden-mobile">Qt笔记</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"ymqRfRF4KqPviKTrJxtv3Tm2-gzGzoHsz","appKey":"LGXIPfn36xtzCvL8XrGGCuzA","path":"window.location.pathname","placeholder":"相遇即是缘分，说点什么再走吧~(/≧▽≦)/","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          Fluid.plugins.initFancyBox('#valine .vcontent img:not(.vemoji)');
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <i class="iconfont icon-copyright"></i> 2022 闲卧庭前远看帆 </br> 封面及部分配图源自互联网 仅作美化之用 版权归图片原作者所有 如有侵权请通过关于页头像下方邮箱联系 侵权作品会被删除</br> Powered by <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> Theme <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <i class="iconfont icon-love"></i>
<div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":1},"log":false});</script></body>
</html>
